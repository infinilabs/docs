<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.79.1"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="How to monitor JVM usage of Elasticsearch cluster nodes #  Introduction #  This article will introduce how to use the INFINI Console to monitor the JVM usage of Elasticsearch cluster nodes and generate alerts.
Prepare #   Download and install the latest version of INFINI Console Register Elasticsearch cluster using INFINI Console  Create alerting rule #  Open INFINI Console in the browser, click on the left menu &ldquo;Alerting&rdquo; > Rules to enter the alerting management page, and then click New button to enter the Create Alerting Rule page."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="How to monitor JVM usage of Elasticsearch cluster nodes"><meta property="og:description" content="How to monitor JVM usage of Elasticsearch cluster nodes #  Introduction #  This article will introduce how to use the INFINI Console to monitor the JVM usage of Elasticsearch cluster nodes and generate alerts.
Prepare #   Download and install the latest version of INFINI Console Register Elasticsearch cluster using INFINI Console  Create alerting rule #  Open INFINI Console in the browser, click on the left menu &ldquo;Alerting&rdquo; > Rules to enter the alerting management page, and then click New button to enter the Create Alerting Rule page."><meta property="og:type" content="article"><meta property="og:url" content="/console/main/docs/tutorials/cluster_node_jvm_usage/"><title>How to monitor JVM usage of Elasticsearch cluster nodes | INFINI Console</title><link rel=manifest href=/console/main/manifest.json><link rel=icon href=/console/main/favicon.png type=image/x-icon><link rel=alternate hreflang=zh href=/console/main/zh/docs/tutorials/cluster_node_jvm_usage/ title="如何监控 Elasticsearch 集群节点的 JVM 使用率"><link rel=stylesheet href=/console/main/book.min.d80e87b12a4b49d9913d0bdd98bd83b7a44988be784760ba15522b377313dcf9.css integrity="sha256-2A6HsSpLSdmRPQvdmL2Dt6RJiL54R2C6FVIrN3MT3Pk="><link rel=stylesheet type=text/css href=/console/main/css/asciinema-player.css><script defer src=/console/main/js/jquery-2.x.min.js></script><script defer src=/console/main/js/doc.js></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/console/main><img src=/console/main/img/logo-en.svg alt=Logo></a></h2><div id=searchbox style=margin-bottom:10px;outline:none></div><div class=heading><select class=version-selector>
<option value>main (latest)</option>
<option value=v1.29.8>v1.29.8</option>
<option value=v1.29.7>v1.29.7</option>
<option value=v1.29.6>v1.29.6</option>
<option value=v1.29.4>v1.29.4</option>
<option value=v1.29.3>v1.29.3</option>
<option value=v1.29.2>v1.29.2</option>
<option value=v1.29.1>v1.29.1</option>
<option value=v1.29.0>v1.29.0</option>
<option value=v1.28.2>v1.28.2</option>
<option value=v1.28.0>v1.28.0</option>
<option value=v1.27.0>v1.27.0</option>
<option value=v1.26.1>v1.26.1</option></select></div><ul><li><input type=checkbox id=section-f1b7c1b2e5dd43526e77637c475d35b8 class=toggle>
<label for=section-f1b7c1b2e5dd43526e77637c475d35b8 class="flex justify-between"><a>Getting Started</a>
<span>▾</span></label><ul><li><a href=/console/main/docs/getting-started/install/>Installation</a></li><li><a href=/console/main/docs/getting-started/docker/>Docker</a></li><li><a href=/console/main/docs/getting-started/dcoker-easysearch/>Deploying Console and Easysearch with Docker Compose</a></li><li><a href=/console/main/docs/getting-started/k8s-easysearch/>Deploying Console and Easysearch in a Kubernetes Cluster</a></li><li><a href=/console/main/docs/getting-started/helm/>Kubernetes</a></li></ul></li><li><input type=checkbox id=section-084ba1dbb512652712ad881ff8045610 class=toggle>
<label for=section-084ba1dbb512652712ad881ff8045610 class="flex justify-between"><a>References</a>
<span>▾</span></label><ul><li><a href=/console/main/docs/reference/setup/>Setup wizard</a><ul></ul></li><li><a href=/console/main/docs/reference/overview/>Overview</a><ul></ul></li><li><input type=checkbox id=section-dc19493497a0afff7833e4e9dc3568aa class=toggle>
<label for=section-dc19493497a0afff7833e4e9dc3568aa class="flex justify-between"><a>Platform</a>
<span>▾</span></label><ul><li><a href=/console/main/docs/reference/platform/overview/>Platform Overview</a></li><li><a href=/console/main/docs/reference/platform/monitoring/>Cluster Monitoring</a></li><li><a href=/console/main/docs/reference/platform/activities/>Cluster Activities</a></li></ul></li><li><input type=checkbox id=section-77e7dc04d6c2293e5fe55f48c5b1a96d class=toggle>
<label for=section-77e7dc04d6c2293e5fe55f48c5b1a96d class="flex justify-between"><a href=/console/main/docs/reference/data/>Data Management</a>
<span>▾</span></label><ul><li><a href=/console/main/docs/reference/data/indices/>Index</a></li><li><a href=/console/main/docs/reference/data/alias/>Alias</a></li><li><a href=/console/main/docs/reference/data/view/>Data View</a></li></ul></li><li><input type=checkbox id=section-1f2a999bd81c4d3893f4d18a1b6bee8a class=toggle>
<label for=section-1f2a999bd81c4d3893f4d18a1b6bee8a class="flex justify-between"><a>Data Insight</a>
<span>▾</span></label><ul><li><a href=/console/main/docs/reference/data-insight/discover/>Discover</a></li></ul></li><li><input type=checkbox id=section-5e5111152017c79ed39a34209990dab7 class=toggle>
<label for=section-5e5111152017c79ed39a34209990dab7 class="flex justify-between"><a>Alerting</a>
<span>▾</span></label><ul><li><a href=/console/main/docs/reference/alerting/message/>Messages</a></li><li><a href=/console/main/docs/reference/alerting/rule/>Rules</a></li><li><a href=/console/main/docs/reference/alerting/channel/>Channels</a></li><li><a href=/console/main/docs/reference/alerting/variables/>Template variables</a></li></ul></li><li><input type=checkbox id=section-9d29fb1eabf25b6edd736a2b92f0b4fe class=toggle>
<label for=section-9d29fb1eabf25b6edd736a2b92f0b4fe class="flex justify-between"><a>Dev Tools</a>
<span>▾</span></label><ul><li><a href=/console/main/docs/reference/dev-tools/dev-tools/>Dev Tools</a></li><li><a href=/console/main/docs/reference/dev-tools/command/>Common Commands</a></li></ul></li><li><input type=checkbox id=section-9a37092c3581f4c91275ae58f0fb21f2 class=toggle>
<label for=section-9a37092c3581f4c91275ae58f0fb21f2 class="flex justify-between"><a>Inventory</a>
<span>▾</span></label><ul><li><a href=/console/main/docs/reference/resource/runtime/>Runtime</a></li><li><a href=/console/main/docs/reference/resource/cluster/>Cluster</a></li><li><a href=/console/main/docs/reference/resource/cluster-agent/>Agent Metric Collect Mode Configuration</a></li></ul></li><li><input type=checkbox id=section-4d372e275e589511fb7282b1f9f3f20f class=toggle>
<label for=section-4d372e275e589511fb7282b1f9f3f20f class="flex justify-between"><a>System</a>
<span>▾</span></label><ul><li><a href=/console/main/docs/reference/system/credential/>Credential</a><ul></ul></li><li><input type=checkbox id=section-89e2a3b5192ba2e5bd11dc7aab78be3d class=toggle>
<label for=section-89e2a3b5192ba2e5bd11dc7aab78be3d class="flex justify-between"><a href=/console/main/docs/reference/system/security/>Security</a>
<span>▾</span></label><ul><li><a href=/console/main/docs/reference/system/security/role/>Role</a></li><li><a href=/console/main/docs/reference/system/security/user/>User</a></li></ul></li><li><a href=/console/main/docs/reference/system/audit/>Audit Logs</a></li></ul></li><li><input type=checkbox id=section-5860fb455fea11f0ed079673fd767cda class=toggle>
<label for=section-5860fb455fea11f0ed079673fd767cda class="flex justify-between"><a>Agent</a>
<span>▾</span></label><ul><li><a href=/console/main/docs/reference/agent/manage/manage/>Overview</a></li><li><a href=/console/main/docs/reference/agent/install/>Installing Agent</a></li><li><a href=/console/main/docs/reference/agent/docker/>Container Deployment</a></li></ul></li></ul></li><li><input type=checkbox id=section-7dd85575c84e6825eb9419e748eb5977 class=toggle checked>
<label for=section-7dd85575c84e6825eb9419e748eb5977 class="flex justify-between"><a>Tutorials</a>
<span>▾</span></label><ul><li><a href=/console/main/docs/tutorials/create_readonly_account/>How to easily create an Elasticsearch "guest" user</a></li><li><a href=/console/main/docs/tutorials/role_with_different_rights/>How to assign different Elasticsearch cluster access permissions to different INFINI Console accounts</a></li><li><a href=/console/main/docs/tutorials/role_with_index_limit/>How to assign Elasticsearch index-level permissions to INFINI Console accounts</a></li><li><a href=/console/main/docs/tutorials/cluster_health_change/>How to Monitor Elasticsearch Cluster Health</a></li><li><a href=/console/main/docs/tutorials/cluster_node_disk_usage/>How to monitor Elasticsearch cluster node disk usage</a></li><li><a href=/console/main/docs/tutorials/cluster_slow_request/>How to monitor slow query requests in Elasticsearch</a></li><li><a href=/console/main/docs/tutorials/cluster_node_cpu_usage/>How to monitor the CPU usage of Elasticsearch cluster nodes</a></li><li><a href=/console/main/docs/tutorials/cluster_node_jvm_usage/ class=active>How to monitor JVM usage of Elasticsearch cluster nodes</a></li><li><a href=/console/main/docs/tutorials/getting_started_with_the_TopN_metrics_feature/>Getting Started with the TopN Metrics Feature in INFINI Console</a></li></ul></li><li><a href=/console/main/docs/user-cases/>User Cases</a><ul></ul></li><li><a href=/console/main/docs/screenshot/>Screenshots</a><ul></ul></li><li><a href=/console/main/docs/troubleshooting/>FAQs</a><ul></ul></li><li><a href=/console/main/docs/release-notes/>Release Notes</a><ul></ul></li></ul><ul><li><a href=https://github.com/infinilabs/console target=_blank rel=noopener>Github</a></li></ul><div class=book-languages tabindex=0 aria-haspopup=true><ul><li class="flex align-center"><img src=/console/main/svg/translate.svg class=book-icon alt=Languages>
English</li></ul><ul class=book-languages-list><li class=active><a href=/console/main/ class="flex align-center"><img src=/console/main/svg/translate.svg class=book-icon alt=Languages>
English</a></li><li><a href=/console/main/zh/docs/tutorials/cluster_node_jvm_usage/ class="flex align-center"><img src=/console/main/svg/translate.svg class=book-icon alt=Languages>
简体中文</a></li></ul></div></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/console/main/svg/menu.svg class=book-icon alt=Menu></label>
<strong>How to monitor JVM usage of Elasticsearch cluster nodes</strong>
<label for=toc-control><img src=/console/main/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#how-to-monitor-jvm-usage-of-elasticsearch-cluster-nodes>How to monitor JVM usage of Elasticsearch cluster nodes</a><ul><li><a href=#introduction>Introduction</a></li><li><a href=#prepare>Prepare</a></li><li><a href=#create-alerting-rule>Create alerting rule</a></li><li><a href=#receive-alert-notification-message>Receive alert notification message</a></li><li><a href=#view-the-alerting-message-center>View the alerting message center</a></li><li><a href=#summary>Summary</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=how-to-monitor-jvm-usage-of-elasticsearch-cluster-nodes>How to monitor JVM usage of Elasticsearch cluster nodes
<a class=anchor href=#how-to-monitor-jvm-usage-of-elasticsearch-cluster-nodes>#</a></h1><h2 id=introduction>Introduction
<a class=anchor href=#introduction>#</a></h2><p>This article will introduce how to use the INFINI Console to monitor the JVM usage of Elasticsearch cluster nodes and generate alerts.</p><h2 id=prepare>Prepare
<a class=anchor href=#prepare>#</a></h2><ul><li>Download and install the latest version of INFINI Console</li><li>Register Elasticsearch cluster using INFINI Console</li></ul><h2 id=create-alerting-rule>Create alerting rule
<a class=anchor href=#create-alerting-rule>#</a></h2><p>Open INFINI Console in the browser, click on the left menu &ldquo;Alerting&rdquo; > Rules to enter the alerting management page, and then click
<code>New</code> button to enter the Create Alerting Rule page. Follow these steps to create an alerting rule:</p><ul><li>Select the cluster (here you need to select the Elasticsearch cluster where the INFINI Console stores data, that is, the Elasticsearch cluster configured in the configuration file <code>console.yml</code>, if it is not registered to the INFINI Console, please register first)</li><li>Input the alerting object <code>.infini_metrics*</code> (select the index under the Elasticsearch cluster, or enter the index pattern, because the monitoring data collected by the INFINI Console is stored in the index .infini_metrics)</li><li>Input filter criteria (Elasticsearch query DSL)
Here we need to filter the monitoring metrics category to <code>node_stats</code> and the metadata category to <code>elasticsearch</code>. The DSL is as follows:</li></ul><pre><code>{
    &quot;bool&quot;: {
        &quot;must&quot;: [
            {
                &quot;term&quot;: {
                    &quot;metadata.name&quot;: {
                        &quot;value&quot;: &quot;node_stats&quot;
                    }
                }
            },
            {
                &quot;term&quot;: {
                    &quot;metadata.category&quot;: {
                        &quot;value&quot;: &quot;elasticsearch&quot;
                    }
                }
            }
        ]
    }
}
</code></pre><ul><li>Select time field <code>timestamp</code> and statistical period for <code>date histogram</code> aggregation</li></ul><p><img src=/console/main/img/screenshot/alerting/Alerting-rules-jvm-1.jpg alt=rules></p><ul><li>Input the rule name</li><li>Group settings (optional, multiple can be configured), set when statistical metrics need to be grouped, because all registered to INFINI Console
The Elasticsearch cluster monitoring metrics are stored in the index <code>.infini_metrics</code>, so you need to group according to the cluster ID first, and then group according to the node ID,
Here we choose <code>metadata.labels.cluster_id</code> and <code>metadata.labels.node_id</code>.</li><li>Configure the alerting metrics, select the aggregation field <code>payload.elasticsearch.node_stats.jvm.mem.heap_used_percent</code>, and the statistics method <code>p90</code>.</li><li>Configure the metrics formula (when more than one alerting metrics is configured, you need to set a formula to calculate the target metrics), where the formula fx is configured as <code>a</code>. Then set the value type of the variable <code>a</code> to the ratio <code>Ratio</code>.</li><li>Configure the alerting conditions, configure three alerting conditions here, configure the <code>P2(Medium)</code> alerting when the JVM usage rate is greater than 50 for <code>continuous one cycle</code>;
Configure <code>continues one cycle</code> when the JVM usage rate is greater than 90, trigger the <code>P1(High)</code> alerting;
Configure the <code>P0(Critical)</code> alerting to be triggered when the JVM usage rate is greater than 95 for one cycle;</li><li>Set the execution period, here is configured to execute a check every minute</li><li>Set the event title, the event title is a template, you can use template variables, template syntax and template variable usage reference
<a href=/console/main/docs/reference/alerting/variables/>here</a></li><li>Set the event content, the event content is a template, you can use template variables, template syntax and template variable usage reference
<a href=/console/main/docs/reference/alerting/variables/>here</a></li></ul><pre><code class=language-aidl data-lang=aidl>Priority:{{.priority}}
Timestamp:{{.timestamp | datetime_in_zone &quot;Asia/Shanghai&quot;}}
RuleID:{{.rule_id}}
EventID:{{.event_id}}
{{range.results}}
ClusterID:{{index.group_values ​​0}};
NodeID:{{index.group_values ​​1}};
JVM used percent: {{.result_value | to_fixed 2}}%;
{{end}}
</code></pre><p><img src=/console/main/img/screenshot/alerting/Alerting-rules-jvm-2.jpg alt=rules></p><ul><li>Turn on the configure alerting channel switch, and select <code>add</code> in the upper right corner to quickly select an alerting channel template to fill. For how to create an alerting channel template, please refer to
<a href=/console/main/>here</a></li><li>Set the silence period to 1 hour, that is, after the alerting rule is triggered, the notification message will only be sent once within an hour</li><li>Set the receiving period, the default is 00:00-23:59, that is, you can receive notification messages throughout the day</li></ul><p><img src=/console/main/img/screenshot/20220725-alerting-cluster-health3.jpg alt="security settings"></p><p><img src=/console/main/img/screenshot/20220725-alerting-cluster-health4.jpg alt="security settings"></p><p>After the settings are complete, click the Save button to submit.</p><h2 id=receive-alert-notification-message>Receive alert notification message
<a class=anchor href=#receive-alert-notification-message>#</a></h2><p>Wait for a while, and receive the DingTalk alerting message notification as follows:</p><p><img src=/console/main/img/screenshot/alerting/Alerting-rules-jvm-3.jpg alt=rules></p><p>You can see that the alert notification message displays the Elasticsearch cluster ID, node ID, and current JVM usage rate triggered by the current rule.</p><h2 id=view-the-alerting-message-center>View the alerting message center
<a class=anchor href=#view-the-alerting-message-center>#</a></h2><p>In addition to receiving external notification messages, the INFINI Console Alert Message Center also generates an alert message. Click menu Alerting > Alerting Center to enter</p><p><img src=/console/main/img/screenshot/alerting/Alerting-rules-jvm-4.jpg alt=rules></p><h2 id=summary>Summary
<a class=anchor href=#summary>#</a></h2><p>By using the INFINI Console alert function, you can easily monitor the JVM usage of Elasticsearch cluster nodes. After configuring alerting rule,
Once any Elasticsearch node JVM usage exceeds a set threshold, an alert will be triggered and an alert message will be sent.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div class=book-languages tabindex=0 aria-haspopup=true><ul><li class="flex align-center"><img src=/console/main/svg/translate.svg class=book-icon alt=Languages>
English</li></ul><ul class=book-languages-list><li class=active><a href=/console/main/ class="flex align-center"><img src=/console/main/svg/translate.svg class=book-icon alt=Languages>
English</a></li><li><a href=/console/main/zh/docs/tutorials/cluster_node_jvm_usage/ class="flex align-center"><img src=/console/main/svg/translate.svg class=book-icon alt=Languages>
简体中文</a></li></ul></div><div><a class="flex align-center" href=https://github.com/infinilabs/console/edit/main/docs/content.en/docs/tutorials/cluster_node_jvm_usage.md target=_blank rel=noopener><img src=/console/main/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div><div class="flex align-center footer">©INFINI.LTD, All Rights Reserved.</div><script async src="https://www.googletagmanager.com/gtag/js?id=G-RJPTVP614C"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-RJPTVP614C');</script><script type=text/javascript>var _smartsupp=_smartsupp||{};_smartsupp.key='691ff544d18a237005a011a7290b839d8fe811a4';window.smartsupp||(function(d){var s,c,o=smartsupp=function(){o._.push(arguments)};o._=[];s=d.getElementsByTagName('script')[0];c=d.createElement('script');c.type='text/javascript';c.charset='utf-8';c.async=true;c.src='https://www.smartsuppchat.com/loader.js?';s.parentNode.insertBefore(c,s);})(document);</script></div><script type=module>
    import { searchbox } from "https://coco.infini.cloud/integration/cvn0g9ehpcehvsthrakg/widget";
    searchbox({container: "#searchbox"});
</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#how-to-monitor-jvm-usage-of-elasticsearch-cluster-nodes>How to monitor JVM usage of Elasticsearch cluster nodes</a><ul><li><a href=#introduction>Introduction</a></li><li><a href=#prepare>Prepare</a></li><li><a href=#create-alerting-rule>Create alerting rule</a></li><li><a href=#receive-alert-notification-message>Receive alert notification message</a></li><li><a href=#view-the-alerting-message-center>View the alerting message center</a></li><li><a href=#summary>Summary</a></li></ul></li></ul></nav></aside></main><script src=/console/main/js/asciinema-player.js></script></body></html>