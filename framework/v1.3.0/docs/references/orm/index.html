<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.79.1"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Object-Relational Mapping #  The INFINI Framework provides a powerful ORM system built on top of Elasticsearch(Including OpenSearch,Easysearch support), enabling developers to define, store, and query structured data objects with ease. The ORM handles object mapping, indexing, and provides a comprehensive set of CRUD operations.
Object Definition #  Objects in the ORM are defined by embedding orm.ORMObjectBase in your struct, which automatically provides all required ORM functionality including system fields for metadata management."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="ORM (Object-Relational Mapping)"><meta property="og:description" content="Object-Relational Mapping #  The INFINI Framework provides a powerful ORM system built on top of Elasticsearch(Including OpenSearch,Easysearch support), enabling developers to define, store, and query structured data objects with ease. The ORM handles object mapping, indexing, and provides a comprehensive set of CRUD operations.
Object Definition #  Objects in the ORM are defined by embedding orm.ORMObjectBase in your struct, which automatically provides all required ORM functionality including system fields for metadata management."><meta property="og:type" content="article"><meta property="og:url" content="/framework/v1.3.0/docs/references/orm/"><title>ORM (Object-Relational Mapping) | INFINI Framework</title><link rel=manifest href=/framework/v1.3.0/manifest.json><link rel=icon href=/framework/v1.3.0/favicon.png type=image/x-icon><link rel=stylesheet href=/framework/v1.3.0/book.min.d80e87b12a4b49d9913d0bdd98bd83b7a44988be784760ba15522b377313dcf9.css integrity="sha256-2A6HsSpLSdmRPQvdmL2Dt6RJiL54R2C6FVIrN3MT3Pk="><script defer src=/framework/v1.3.0/js/jquery-2.x.min.js></script><script defer src=/framework/v1.3.0/js/doc.js></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/framework/v1.3.0><img src=/framework/v1.3.0/img/logo-en.svg alt=Logo></a></h2><div id=searchbox style=margin-bottom:10px;outline:none></div><div class=heading><select class=version-selector>
<option value>main (latest)</option>
<option value=v1.3.0>v1.3.0</option>
<option value=v1.2.0>v1.2.0</option>
<option value=v1.1.9>v1.1.9</option>
<option value=v1.1.8>v1.1.8</option>
<option value=v1.1.7>v1.1.7</option>
<option value=v1.1.6>v1.1.6</option>
<option value=v1.1.5>v1.1.5</option>
<option value=v1.1.4>v1.1.4</option>
<option value=v1.1.3>v1.1.3</option>
<option value=v1.1.2>v1.1.2</option>
<option value=v1.1.0>v1.1.0</option>
<option value=v1.0.0>v1.0.0</option></select></div><ul><li><a href=/framework/v1.3.0/docs/development/>Development</a><ul><li><a href=/framework/v1.3.0/docs/development/setup_golang_environment/>Setting Up the Golang Environment</a></li><li><a href=/framework/v1.3.0/docs/development/setup_intellij_idea/>Setup IntelliJ IDEA</a></li><li><a href=/framework/v1.3.0/docs/development/create_new_application/>Create New Application</a></li></ul></li><li><input type=checkbox id=section-fb088f8a9be33f7f260ad2b140bb7bdc class=toggle checked>
<label for=section-fb088f8a9be33f7f260ad2b140bb7bdc class="flex justify-between"><a>References</a>
<span>â–¾</span></label><ul><li><a href=/framework/v1.3.0/docs/references/makefile/>Makefile</a></li><li><a href=/framework/v1.3.0/docs/references/api_web/>API & Web Framework</a></li><li><a href=/framework/v1.3.0/docs/references/orm/ class=active>ORM (Object-Relational Mapping)</a></li><li><a href=/framework/v1.3.0/docs/references/http_client/>Http Client Configuration</a></li><li><a href=/framework/v1.3.0/docs/references/query_url/>Query URL Parameters</a></li><li><a href=/framework/v1.3.0/docs/references/aggs_query/>Aggregation via URL Parameters</a></li></ul></li><li><a href=/framework/v1.3.0/docs/troubleshooting/>FAQs</a><ul></ul></li><li><a href=/framework/v1.3.0/docs/release-notes/>Release Notes</a><ul></ul></li></ul><ul><li><a href=https://github.com/infinilabs/framework target=_blank rel=noopener>Github</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/framework/v1.3.0/svg/menu.svg class=book-icon alt=Menu></label>
<strong>ORM (Object-Relational Mapping)</strong>
<label for=toc-control><img src=/framework/v1.3.0/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#object-relational-mapping>Object-Relational Mapping</a><ul><li><a href=#object-definition>Object Definition</a><ul><li><a href=#key-principle-ormobjectbase-inheritance>Key Principle: ORMObjectBase Inheritance</a></li><li><a href=#basic-object-structure>Basic Object Structure</a></li><li><a href=#nested-inheritance-building-on-base-objects>Nested Inheritance: Building on Base Objects</a></li><li><a href=#advanced-object-definition-with-elasticsearch-mapping>Advanced Object Definition with Elasticsearch Mapping</a></li></ul></li><li><a href=#object-registration>Object Registration</a><ul><li><a href=#simple-registration>Simple Registration</a></li><li><a href=#registration-with-context>Registration with Context</a></li></ul></li><li><a href=#elasticsearch-mapping-with-elastic_mapping>Elasticsearch Mapping with elastic_mapping</a><ul><li><a href=#common-mapping-parameters>Common Mapping Parameters</a></li><li><a href=#advanced-mapping-options>Advanced Mapping Options</a></li><li><a href=#real-world-datasource-example>Real-World DataSource Example</a></li></ul></li><li><a href=#crud-operations>CRUD Operations</a><ul><li><a href=#create-create>Create (Create)</a></li><li><a href=#read-get>Read (Get)</a></li><li><a href=#update-updateupsert>Update (Update/Upsert)</a></li><li><a href=#delete-delete>Delete (Delete)</a></li></ul></li><li><a href=#advanced-operations>Advanced Operations</a><ul><li><a href=#search-with-query-builder>Search with Query Builder</a></li><li><a href=#complex-search-with-text-queries>Complex Search with Text Queries</a></li><li><a href=#delete-by-query>Delete by Query</a></li></ul></li><li><a href=#context-options>Context Options</a></li><li><a href=#real-world-example-datasource-module>Real-World Example: DataSource Module</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=object-relational-mapping>Object-Relational Mapping
<a class=anchor href=#object-relational-mapping>#</a></h1><p>The INFINI Framework provides a powerful ORM system built on top of Elasticsearch(Including OpenSearch,Easysearch support), enabling developers to define, store, and query structured data objects with ease. The ORM handles object mapping, indexing, and provides a comprehensive set of CRUD operations.</p><h2 id=object-definition>Object Definition
<a class=anchor href=#object-definition>#</a></h2><p>Objects in the ORM are defined by embedding <code>orm.ORMObjectBase</code> in your struct, which automatically provides all required ORM functionality including system fields for metadata management. Objects must also implement the <code>Object</code> interface with <code>GetID()</code> and <code>SetID(string)</code> methods.</p><h3 id=key-principle-ormobjectbase-inheritance>Key Principle: ORMObjectBase Inheritance
<a class=anchor href=#key-principle-ormobjectbase-inheritance>#</a></h3><p><strong>To make any struct ORM-capable, you must embed <code>orm.ORMObjectBase</code> as the first field.</strong> This provides:</p><ul><li>System fields for metadata management</li><li>Required interface implementations</li><li>Automatic timestamp handling</li><li>Built-in ID management</li></ul><h3 id=basic-object-structure>Basic Object Structure
<a class=anchor href=#basic-object-structure>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#75715e>// Basic ORM object with ORMObjectBase inheritance
</span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>User</span> <span style=color:#66d9ef>struct</span> {
    <span style=color:#75715e>// EMBED ORMObjectBase as the first field - REQUIRED
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>ORMObjectBase</span>        <span style=color:#75715e>// Embedding ORM base for persistence-related fields
</span><span style=color:#75715e></span>
    <span style=color:#75715e>// Custom fields
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>Name</span>      <span style=color:#66d9ef>string</span>    <span style=color:#e6db74>`json:&#34;name&#34;`</span>
    <span style=color:#a6e22e>Email</span>     <span style=color:#66d9ef>string</span>    <span style=color:#e6db74>`json:&#34;email&#34;`</span>
    <span style=color:#a6e22e>Age</span>       <span style=color:#66d9ef>int</span>       <span style=color:#e6db74>`json:&#34;age&#34;`</span>
}

<span style=color:#75715e>// Implement required Object interface methods (ORMObjectBase already handles GetID/SetID)
</span></code></pre></div><h3 id=nested-inheritance-building-on-base-objects>Nested Inheritance: Building on Base Objects
<a class=anchor href=#nested-inheritance-building-on-base-objects>#</a></h3><p>The ORM supports nested inheritance, allowing you to create reusable base objects and extend them:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#75715e>// Define a base object with shared functionality
</span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>CombinedFullText</span> <span style=color:#66d9ef>struct</span> {
    <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>ORMObjectBase</span>        <span style=color:#75715e>// Embedding ORM base for persistence-related fields
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>CombinedFullText</span>  <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;-&#34; elastic_mapping:&#34;combined_fulltext:{type:text,index_prefixes:{},index_phrases:true,analyzer:combined_text_analyzer }&#34;`</span>

    <span style=color:#a6e22e>Metadata</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{} <span style=color:#e6db74>`json:&#34;metadata,omitempty&#34; elastic_mapping:&#34;metadata:{type:object}&#34;`</span> <span style=color:#75715e>// Additional accessible metadata
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>Payload</span>  <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{} <span style=color:#e6db74>`json:&#34;payload,omitempty&#34; elastic_mapping:&#34;payload:{enabled:false}&#34;`</span> <span style=color:#75715e>// Store-only metadata
</span><span style=color:#75715e></span>}

<span style=color:#75715e>// Extend the base object with specific fields
</span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>DataSource</span> <span style=color:#66d9ef>struct</span> {
    <span style=color:#a6e22e>CombinedFullText</span>  <span style=color:#75715e>// Inherit all fields from base object
</span><span style=color:#75715e></span>
    <span style=color:#a6e22e>Type</span>        <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;type,omitempty&#34; elastic_mapping:&#34;type:{type:keyword,copy_to:combined_fulltext}&#34;`</span>
    <span style=color:#a6e22e>Name</span>        <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;name&#34; elastic_mapping:&#34;name:{type:keyword,copy_to:combined_fulltext,fields:{text: {type: text}, pinyin: {type: text, analyzer: pinyin_analyzer}}}&#34;`</span>
    <span style=color:#a6e22e>Description</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;description,omitempty&#34; elastic_mapping:&#34;description:{type:text,copy_to:combined_fulltext}&#34;`</span>
    <span style=color:#a6e22e>Icon</span>        <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;icon,omitempty&#34; elastic_mapping:&#34;icon:{enabled:false}&#34;`</span>
    <span style=color:#a6e22e>Category</span>    <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;category,omitempty&#34; elastic_mapping:&#34;category:{type:keyword}&#34;`</span>
    <span style=color:#a6e22e>Tags</span>        []<span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;tags,omitempty&#34; elastic_mapping:&#34;tags:{type:keyword}&#34;`</span>
    <span style=color:#a6e22e>Connector</span>   <span style=color:#a6e22e>ConnectorConfig</span> <span style=color:#e6db74>`json:&#34;connector,omitempty&#34; elastic_mapping:&#34;connector:{type:object}&#34;`</span>
    <span style=color:#a6e22e>Enabled</span>     <span style=color:#66d9ef>bool</span>   <span style=color:#e6db74>`json:&#34;enabled&#34; elastic_mapping:&#34;enabled:{type:keyword}&#34;`</span>
}
</code></pre></div><h3 id=advanced-object-definition-with-elasticsearch-mapping>Advanced Object Definition with Elasticsearch Mapping
<a class=anchor href=#advanced-object-definition-with-elasticsearch-mapping>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Document</span> <span style=color:#66d9ef>struct</span> {
    <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>ORMObjectBase</span>        <span style=color:#75715e>// Embedding ORM base for persistence-related fields
</span><span style=color:#75715e></span>
    <span style=color:#a6e22e>Title</span>       <span style=color:#66d9ef>string</span>    <span style=color:#e6db74>`json:&#34;title&#34; elastic_mapping:&#34;title: { type: text, analyzer: standard }&#34;`</span>
    <span style=color:#a6e22e>Content</span>     <span style=color:#66d9ef>string</span>    <span style=color:#e6db74>`json:&#34;content&#34; elastic_mapping:&#34;content: { type: text, analyzer: standard }&#34;`</span>
    <span style=color:#a6e22e>Tags</span>        []<span style=color:#66d9ef>string</span>  <span style=color:#e6db74>`json:&#34;tags&#34; elastic_mapping:&#34;tags: { type: keyword }&#34;`</span>
    <span style=color:#a6e22e>Status</span>      <span style=color:#66d9ef>string</span>    <span style=color:#e6db74>`json:&#34;status&#34; elastic_mapping:&#34;status: { type: keyword }&#34;`</span>

    <span style=color:#a6e22e>Source</span>      <span style=color:#a6e22e>DataSourceReference</span> <span style=color:#e6db74>`json:&#34;source&#34;`</span>
}
</code></pre></div><h2 id=object-registration>Object Registration
<a class=anchor href=#object-registration>#</a></h2><p>Objects must be registered with the ORM before use. Registration typically happens during application initialization. <strong>Note: Schema initialization is handled automatically - you only need to register your objects.</strong></p><h3 id=simple-registration>Simple Registration
<a class=anchor href=#simple-registration>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#75715e>// Register object with custom index name
</span><span style=color:#75715e></span><span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>MustRegisterSchemaWithIndexName</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>User</span>{}, <span style=color:#e6db74>&#34;users&#34;</span>)

<span style=color:#75715e>// Register with default naming (struct name lowercase + &#39;s&#39;)
</span><span style=color:#75715e></span><span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>MustRegisterSchemaWithIndexName</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Document</span>{}, <span style=color:#e6db74>&#34;documents&#34;</span>)

<span style=color:#75715e>// Registration is complete - no additional initialization needed!
</span></code></pre></div><h3 id=registration-with-context>Registration with Context
<a class=anchor href=#registration-with-context>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#75715e>// For advanced scenarios with sharing/multitenancy
</span><span style=color:#75715e></span><span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>NewContext</span>()
<span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>WithModel</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>User</span>{})
<span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>WithModel</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Document</span>{})
</code></pre></div><h2 id=elasticsearch-mapping-with-elastic_mapping>Elasticsearch Mapping with elastic_mapping
<a class=anchor href=#elasticsearch-mapping-with-elastic_mapping>#</a></h2><p>The <code>elastic_mapping</code> tag allows you to define Elasticsearch field mappings directly in your Go struct. This provides fine-grained control over how your data is indexed and queried.</p><h3 id=common-mapping-parameters>Common Mapping Parameters
<a class=anchor href=#common-mapping-parameters>#</a></h3><table><thead><tr><th>Parameter</th><th>Description</th><th>Example</th></tr></thead><tbody><tr><td><code>type</code></td><td>Field data type</td><td><code>type:text</code>, <code>type:keyword</code>, <code>type:date</code></td></tr><tr><td><code>analyzer</code></td><td>Text analyzer for indexing and searching</td><td><code>analyzer:standard</code>, <code>analyzer:ik_max_word</code></td></tr><tr><td><code>index</code></td><td>Whether field should be indexed</td><td><code>index:false</code>, <code>index:true</code></td></tr><tr><td><code>enabled</code></td><td>Enable/disable field processing</td><td><code>enabled:false</code>, <code>enabled:true</code></td></tr><tr><td><code>store</code></td><td>Store field values separately</td><td><code>store:true</code></td></tr><tr><td><code>copy_to</code></td><td>Copy field value to another field</td><td><code>copy_to:combined_fulltext</code></td></tr><tr><td><code>fields</code></td><td>Define multi-fields for different analysis</td><td><code>fields:{keyword: {type: keyword}}</code></td></tr><tr><td><code>format</code></td><td>Date format for date fields</td><td><code>format:yyyy-MM-dd HH:mm:ss</code></td></tr></tbody></table><h3 id=advanced-mapping-options>Advanced Mapping Options
<a class=anchor href=#advanced-mapping-options>#</a></h3><h4 id=multi-field-mapping>Multi-field Mapping
<a class=anchor href=#multi-field-mapping>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Product</span> <span style=color:#66d9ef>struct</span> {
    <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>ORMObjectBase</span>

    <span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;name&#34; elastic_mapping:&#34;name:{type:text,analyzer:standard,fields:{keyword:{type:keyword},raw:{type:keyword,index:false}}}&#34;`</span>
}
</code></pre></div><h4 id=object-mapping>Object Mapping
<a class=anchor href=#object-mapping>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>User</span> <span style=color:#66d9ef>struct</span> {
    <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>ORMObjectBase</span>

    <span style=color:#a6e22e>Address</span> <span style=color:#a6e22e>Address</span> <span style=color:#e6db74>`json:&#34;address&#34; elastic_mapping:&#34;address:{type:object,properties:{city:{type:keyword},country:{type:keyword}}}&#34;`</span>
}

<span style=color:#75715e>// OR dynamic object mapping
</span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Config</span> <span style=color:#66d9ef>struct</span> {
    <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>ORMObjectBase</span>

    <span style=color:#a6e22e>Settings</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{} <span style=color:#e6db74>`json:&#34;settings&#34; elastic_mapping:&#34;settings:{type:object}&#34;`</span>
}
</code></pre></div><h4 id=store-only-mapping>Store-only Mapping
<a class=anchor href=#store-only-mapping>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Attachment</span> <span style=color:#66d9ef>struct</span> {
    <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>ORMObjectBase</span>

    <span style=color:#a6e22e>FileName</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;filename&#34;`</span>
    <span style=color:#a6e22e>FileData</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;file_data&#34; elastic_mapping:&#34;file_data:{enabled:false}&#34;`</span> <span style=color:#75715e>// Not indexed, just stored
</span><span style=color:#75715e></span>}
</code></pre></div><h4 id=text-analysis-with-multiple-analyzers>Text Analysis with Multiple Analyzers
<a class=anchor href=#text-analysis-with-multiple-analyzers>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Content</span> <span style=color:#66d9ef>struct</span> {
    <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>ORMObjectBase</span>

    <span style=color:#a6e22e>Title</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;title&#34; elastic_mapping:&#34;title:{type:text,analyzer:standard,fields:{pinyin:{type:text,analyzer:pinyin_analyzer},keyword:{type:keyword}}}&#34;`</span>
}
</code></pre></div><h3 id=real-world-datasource-example>Real-World DataSource Example
<a class=anchor href=#real-world-datasource-example>#</a></h3><p>From the actual codebase showing advanced mapping patterns:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>CombinedFullText</span> <span style=color:#66d9ef>struct</span> {
    <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>ORMObjectBase</span>
    <span style=color:#a6e22e>CombinedFullText</span>  <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;-&#34; elastic_mapping:&#34;combined_fulltext:{type:text,index_prefixes:{},index_phrases:true,analyzer:combined_text_analyzer}&#34;`</span>

    <span style=color:#a6e22e>Metadata</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{} <span style=color:#e6db74>`json:&#34;metadata,omitempty&#34; elastic_mapping:&#34;metadata:{type:object}&#34;`</span> <span style=color:#75715e>// Searchable metadata
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>Payload</span>  <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{} <span style=color:#e6db74>`json:&#34;payload,omitempty&#34; elastic_mapping:&#34;payload:{enabled:false}&#34;`</span> <span style=color:#75715e>// Store-only metadata
</span><span style=color:#75715e></span>}

<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>DataSource</span> <span style=color:#66d9ef>struct</span> {
    <span style=color:#a6e22e>CombinedFullText</span>  <span style=color:#75715e>// Inherits all base fields
</span><span style=color:#75715e></span>
    <span style=color:#a6e22e>Type</span>        <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;type,omitempty&#34; elastic_mapping:&#34;type:{type:keyword,copy_to:combined_fulltext}&#34;`</span>
    <span style=color:#a6e22e>Name</span>        <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;name&#34; elastic_mapping:&#34;name:{type:keyword,copy_to:combined_fulltext,fields:{text:{type:text},pinyin:{type:text,analyzer:pinyin_analyzer}}}&#34;`</span>
    <span style=color:#a6e22e>Description</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;description,omitempty&#34; elastic_mapping:&#34;description:{type:text,copy_to:combined_fulltext}&#34;`</span>
    <span style=color:#a6e22e>Icon</span>        <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;icon,omitempty&#34; elastic_mapping:&#34;icon:{enabled:false}&#34;`</span>
    <span style=color:#a6e22e>Category</span>    <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;category,omitempty&#34; elastic_mapping:&#34;category:{type:keyword}&#34;`</span>
    <span style=color:#a6e22e>Tags</span>        []<span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;tags,omitempty&#34; elastic_mapping:&#34;tags:{type:keyword}&#34;`</span>
    <span style=color:#a6e22e>Connector</span>   <span style=color:#a6e22e>ConnectorConfig</span> <span style=color:#e6db74>`json:&#34;connector,omitempty&#34; elastic_mapping:&#34;connector:{type:object}&#34;`</span>
    <span style=color:#a6e22e>Enabled</span>     <span style=color:#66d9ef>bool</span> <span style=color:#e6db74>`json:&#34;enabled&#34; elastic_mapping:&#34;enabled:{type:keyword}&#34;`</span>
}
</code></pre></div><h2 id=crud-operations>CRUD Operations
<a class=anchor href=#crud-operations>#</a></h2><h3 id=create-create>Create (Create)
<a class=anchor href=#create-create>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>createUser</span>() {
    <span style=color:#75715e>// Create context
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>NewContext</span>()
    <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Refresh</span> = <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>WaitForRefresh</span> <span style=color:#75715e>// Wait for index refresh
</span><span style=color:#75715e></span>
    <span style=color:#75715e>// Create new user - ID and timestamps handled automatically by ORMObjectBase
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>user</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>User</span>{
        <span style=color:#a6e22e>Name</span>:    <span style=color:#e6db74>&#34;John Doe&#34;</span>,
        <span style=color:#a6e22e>Email</span>:   <span style=color:#e6db74>&#34;john@example.com&#34;</span>,
        <span style=color:#a6e22e>Age</span>:     <span style=color:#ae81ff>25</span>,
    }

    <span style=color:#75715e>// Insert into database
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>Create</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>user</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;Failed to create user:&#34;</span>, <span style=color:#a6e22e>err</span>)
        <span style=color:#66d9ef>return</span>
    }

    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;User created with ID: %s\n&#34;</span>, <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>GetID</span>())
}
</code></pre></div><h3 id=read-get>Read (Get)
<a class=anchor href=#read-get>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getUser</span>() {
    <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>NewContext</span>()

    <span style=color:#a6e22e>user</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>User</span>{}
    <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>ID</span> = <span style=color:#e6db74>&#34;user-id-123&#34;</span>

    <span style=color:#75715e>// Get user by ID
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>exists</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>GetV2</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>user</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;Failed to get user:&#34;</span>, <span style=color:#a6e22e>err</span>)
        <span style=color:#66d9ef>return</span>
    }

    <span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>exists</span> {
        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;User not found&#34;</span>)
        <span style=color:#66d9ef>return</span>
    }

    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Found user: %s, Email: %s\n&#34;</span>, <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>Name</span>, <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>Email</span>)
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getUserWithSystemFields</span>() {
    <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>NewContext</span>()

    <span style=color:#a6e22e>user</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>User</span>{}
    <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>ID</span> = <span style=color:#e6db74>&#34;user-id-123&#34;</span>

    <span style=color:#75715e>// Get user including system fields
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>exists</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>GetWithSystemFields</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>user</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;Failed to get user:&#34;</span>, <span style=color:#a6e22e>err</span>)
        <span style=color:#66d9ef>return</span>
    }

    <span style=color:#75715e>// Access system fields
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>exists</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>System</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>ownerID</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>GetOwnerID</span>()
        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;User owner ID: %s\n&#34;</span>, <span style=color:#a6e22e>ownerID</span>)
    }
}
</code></pre></div><h3 id=update-updateupsert>Update (Update/Upsert)
<a class=anchor href=#update-updateupsert>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>updateUser</span>() {
    <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>NewContext</span>()
    <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Refresh</span> = <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>WaitForRefresh</span>

    <span style=color:#75715e>// Get existing user - timestamps handled automatically
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>user</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>User</span>{}
    <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>SetID</span>(<span style=color:#e6db74>&#34;user-id-123&#34;</span>) <span style=color:#75715e>// or use GetID() if you have the object
</span><span style=color:#75715e></span>
    <span style=color:#a6e22e>exists</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>GetV2</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>user</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> <span style=color:#f92672>||</span> !<span style=color:#a6e22e>exists</span> {
        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;User not found&#34;</span>)
        <span style=color:#66d9ef>return</span>
    }

    <span style=color:#75715e>// Update fields - Updated timestamp handled automatically
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>Name</span> = <span style=color:#e6db74>&#34;John Smith&#34;</span>

    <span style=color:#75715e>// Update in database
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>Update</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>user</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;Failed to update user:&#34;</span>, <span style=color:#a6e22e>err</span>)
        <span style=color:#66d9ef>return</span>
    }

    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;User updated successfully&#34;</span>)
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>updatePartialFields</span>() {
    <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>NewContext</span>()
    <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Refresh</span> = <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>WaitForRefresh</span>

    <span style=color:#75715e>// Update only specific fields
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>updates</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>util</span>.<span style=color:#a6e22e>MapStr</span>{
        <span style=color:#e6db74>&#34;name&#34;</span>:  <span style=color:#e6db74>&#34;Johnny Doe&#34;</span>,
        <span style=color:#e6db74>&#34;email&#34;</span>: <span style=color:#e6db74>&#34;johnny@example.com&#34;</span>,
    }

    <span style=color:#a6e22e>user</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>User</span>{}
    <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>ID</span> = <span style=color:#e6db74>&#34;user-id-123&#34;</span>

    <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>UpdatePartialFields</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>user</span>, <span style=color:#a6e22e>updates</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;Failed to update user:&#34;</span>, <span style=color:#a6e22e>err</span>)
        <span style=color:#66d9ef>return</span>
    }

    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;User partially updated successfully&#34;</span>)
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>upsertUser</span>() {
    <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>NewContext</span>()
    <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Refresh</span> = <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>WaitForRefresh</span>

    <span style=color:#75715e>// Create or update user - timestamps handled automatically
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>user</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>User</span>{
        <span style=color:#a6e22e>Name</span>:    <span style=color:#e6db74>&#34;John Updated&#34;</span>,
        <span style=color:#a6e22e>Email</span>:   <span style=color:#e6db74>&#34;john.updated@example.com&#34;</span>,
    }

    <span style=color:#75715e>// Use existing ID if updating, or SetID will generate one if needed
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>SetID</span>(<span style=color:#e6db74>&#34;user-id-123&#34;</span>)

    <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>Upsert</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>user</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;Failed to upsert user:&#34;</span>, <span style=color:#a6e22e>err</span>)
        <span style=color:#66d9ef>return</span>
    }

    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;User upserted successfully&#34;</span>)
}
</code></pre></div><h3 id=delete-delete>Delete (Delete)
<a class=anchor href=#delete-delete>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>deleteUser</span>() {
    <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>NewContext</span>()
    <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Refresh</span> = <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>WaitForRefresh</span>

    <span style=color:#a6e22e>user</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>User</span>{}
    <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>SetID</span>(<span style=color:#e6db74>&#34;user-id-123&#34;</span>)

    <span style=color:#75715e>// Delete user
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>Delete</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>user</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;Failed to delete user:&#34;</span>, <span style=color:#a6e22e>err</span>)
        <span style=color:#66d9ef>return</span>
    }

    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;User deleted successfully&#34;</span>)
}
</code></pre></div><h2 id=advanced-operations>Advanced Operations
<a class=anchor href=#advanced-operations>#</a></h2><h3 id=search-with-query-builder>Search with Query Builder
<a class=anchor href=#search-with-query-builder>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>searchUsers</span>() {
    <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>NewContext</span>()

    <span style=color:#75715e>// Create query builder
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>builder</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>NewQueryBuilder</span>()

    <span style=color:#75715e>// Add filters
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>builder</span>.<span style=color:#a6e22e>Filter</span>(<span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>TermQuery</span>(<span style=color:#e6db74>&#34;age&#34;</span>, <span style=color:#ae81ff>25</span>))
    <span style=color:#a6e22e>builder</span>.<span style=color:#a6e22e>Filter</span>(<span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>RangeQuery</span>(<span style=color:#e6db74>&#34;created&#34;</span>, <span style=color:#a6e22e>util</span>.<span style=color:#a6e22e>MapStr</span>{
        <span style=color:#e6db74>&#34;gte&#34;</span>: <span style=color:#e6db74>&#34;2023-01-01&#34;</span>,
        <span style=color:#e6db74>&#34;lte&#34;</span>: <span style=color:#e6db74>&#34;2023-12-31&#34;</span>,
    }))

    <span style=color:#75715e>// Add sorting
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>builder</span>.<span style=color:#a6e22e>SortBy</span>(<span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>Sort</span>{<span style=color:#a6e22e>Field</span>: <span style=color:#e6db74>&#34;created&#34;</span>, <span style=color:#a6e22e>SortType</span>: <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>DESC</span>})

    <span style=color:#75715e>// Execute search
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>users</span> []<span style=color:#a6e22e>User</span>
    <span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>result</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>elastic</span>.<span style=color:#a6e22e>SearchV2WithResultItemMapper</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>users</span>, <span style=color:#a6e22e>builder</span>, <span style=color:#66d9ef>nil</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;Search failed:&#34;</span>, <span style=color:#a6e22e>err</span>)
        <span style=color:#66d9ef>return</span>
    }

    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Found %d users\n&#34;</span>, len(<span style=color:#a6e22e>users</span>))
    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>user</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>users</span> {
        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;User: %s (%s)\n&#34;</span>, <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>Name</span>, <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>Email</span>)
    }
}
</code></pre></div><h3 id=complex-search-with-text-queries>Complex Search with Text Queries
<a class=anchor href=#complex-search-with-text-queries>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>searchDocuments</span>() {
    <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>NewContext</span>()

    <span style=color:#a6e22e>builder</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>NewQueryBuilderFromRequest</span>(<span style=color:#a6e22e>req</span>, <span style=color:#e6db74>&#34;title&#34;</span>, <span style=color:#e6db74>&#34;content&#34;</span>)

    <span style=color:#75715e>// Enable body bytes for receiving additional Raw QueryDSL
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>builder</span>.<span style=color:#a6e22e>EnableBodyBytes</span>()

    <span style=color:#75715e>// Add date range filter
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>builder</span>.<span style=color:#a6e22e>Filter</span>(<span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>RangeQuery</span>(<span style=color:#e6db74>&#34;created&#34;</span>, <span style=color:#a6e22e>util</span>.<span style=color:#a6e22e>MapStr</span>{
        <span style=color:#e6db74>&#34;gte&#34;</span>: <span style=color:#e6db74>&#34;2024-01-01&#34;</span>,
    }))

    <span style=color:#75715e>// Add pagination
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>builder</span>.<span style=color:#a6e22e>Size</span>(<span style=color:#ae81ff>20</span>).<span style=color:#a6e22e>From</span>(<span style=color:#ae81ff>0</span>)

    <span style=color:#75715e>// Add aggregations
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Set</span>(<span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>AggsTerms</span>, <span style=color:#e6db74>&#34;tags&#34;</span>)

    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>docs</span> []<span style=color:#a6e22e>Document</span>
    <span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>result</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>elastic</span>.<span style=color:#a6e22e>SearchV2WithResultItemMapper</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>docs</span>, <span style=color:#a6e22e>builder</span>, <span style=color:#66d9ef>nil</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;Search failed:&#34;</span>, <span style=color:#a6e22e>err</span>)
        <span style=color:#66d9ef>return</span>
    }

    <span style=color:#75715e>// Process results
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Found %d documents\n&#34;</span>, len(<span style=color:#a6e22e>docs</span>))
}
</code></pre></div><h3 id=delete-by-query>Delete by Query
<a class=anchor href=#delete-by-query>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>deleteOldUsers</span>() {
    <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>NewContext</span>()

    <span style=color:#75715e>// Create delete query
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>builder</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>NewQueryBuilder</span>()
    <span style=color:#a6e22e>builder</span>.<span style=color:#a6e22e>Filter</span>(<span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>RangeQuery</span>(<span style=color:#e6db74>&#34;created&#34;</span>, <span style=color:#a6e22e>util</span>.<span style=color:#a6e22e>MapStr</span>{
        <span style=color:#e6db74>&#34;lt&#34;</span>: <span style=color:#e6db74>&#34;2022-01-01&#34;</span>, <span style=color:#75715e>// Delete users created before 2022
</span><span style=color:#75715e></span>    }))

    <span style=color:#75715e>// Execute delete by query
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>result</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>DeleteByQuery</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>builder</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;Delete by query failed:&#34;</span>, <span style=color:#a6e22e>err</span>)
        <span style=color:#66d9ef>return</span>
    }

    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Deleted %d old users\n&#34;</span>, <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Deleted</span>)
}
</code></pre></div><h2 id=context-options>Context Options
<a class=anchor href=#context-options>#</a></h2><p>The ORM provides various context options for controlling behavior:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>NewContext</span>()

<span style=color:#75715e>// Wait for index refresh
</span><span style=color:#75715e></span><span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Refresh</span> = <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>WaitForRefresh</span>

<span style=color:#75715e>// Enable sharing for multi-tenant systems
</span><span style=color:#75715e></span><span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Set</span>(<span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>SharingEnabled</span>, <span style=color:#66d9ef>true</span>)
<span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Set</span>(<span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>SharingResourceType</span>, <span style=color:#e6db74>&#34;users&#34;</span>)
<span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Set</span>(<span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>SharingCategoryCheckingChildrenEnabled</span>, <span style=color:#66d9ef>true</span>)

<span style=color:#75715e>// Keep system fields
</span><span style=color:#75715e></span><span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Set</span>(<span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>KeepSystemFields</span>, <span style=color:#66d9ef>true</span>)

<span style=color:#75715e>// Model binding for type-safe operations
</span><span style=color:#75715e></span><span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>WithModel</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>User</span>{})

<span style=color:#75715e>// Set custom timeout
</span><span style=color:#75715e></span><span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>SetTimeout</span>(<span style=color:#ae81ff>30</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</code></pre></div><h2 id=real-world-example-datasource-module>Real-World Example: DataSource Module
<a class=anchor href=#real-world-example-datasource-module>#</a></h2><p>Here&rsquo;s how the ORM is used in the actual codebase:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>h</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>APIHandler</span>) <span style=color:#a6e22e>createDatasource</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>, <span style=color:#a6e22e>ps</span> <span style=color:#a6e22e>httprouter</span>.<span style=color:#a6e22e>Params</span>) {
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>obj</span> = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>core</span>.<span style=color:#a6e22e>DataSource</span>{}
    <span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>MustDecodeJSON</span>(<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>obj</span>)

    <span style=color:#75715e>// Check referenced connector
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>obj</span>.<span style=color:#a6e22e>Connector</span>.<span style=color:#a6e22e>ConnectorID</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
        panic(<span style=color:#e6db74>&#34;invalid connector&#34;</span>)
    }

    <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>NewContextWithParent</span>(<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>Context</span>())

    <span style=color:#75715e>// Validate related object
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>connector</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>core</span>.<span style=color:#a6e22e>Connector</span>{}
    <span style=color:#a6e22e>connector</span>.<span style=color:#a6e22e>ID</span> = <span style=color:#a6e22e>obj</span>.<span style=color:#a6e22e>Connector</span>.<span style=color:#a6e22e>ConnectorID</span>
    <span style=color:#a6e22e>exists</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>GetV2</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>connector</span>)
    <span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>exists</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        panic(<span style=color:#e6db74>&#34;invalid connector&#34;</span>)
    }

    <span style=color:#75715e>// Set refresh option and create
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Refresh</span> = <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>WaitForRefresh</span>
    <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>orm</span>.<span style=color:#a6e22e>Create</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>obj</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>WriteError</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>(), <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusInternalServerError</span>)
        <span style=color:#66d9ef>return</span>
    }

    <span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>WriteJSON</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>util</span>.<span style=color:#a6e22e>MapStr</span>{
        <span style=color:#e6db74>&#34;_id&#34;</span>:    <span style=color:#a6e22e>obj</span>.<span style=color:#a6e22e>ID</span>,
        <span style=color:#e6db74>&#34;result&#34;</span>: <span style=color:#e6db74>&#34;created&#34;</span>,
    }, <span style=color:#ae81ff>200</span>)
}
</code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/infinilabs/framework/edit/v1.3.0/docs/content.en/docs/references/orm.md target=_blank rel=noopener><img src=/framework/v1.3.0/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div><div class="flex align-center footer">Â©INFINI.LTD, All Rights Reserved.</div><script async src="https://www.googletagmanager.com/gtag/js?id=G-RJPTVP614C"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-RJPTVP614C');</script><script type=text/javascript>var _smartsupp=_smartsupp||{};_smartsupp.key='691ff544d18a237005a011a7290b839d8fe811a4';window.smartsupp||(function(d){var s,c,o=smartsupp=function(){o._.push(arguments)};o._=[];s=d.getElementsByTagName('script')[0];c=d.createElement('script');c.type='text/javascript';c.charset='utf-8';c.async=true;c.src='https://www.smartsuppchat.com/loader.js?';s.parentNode.insertBefore(c,s);})(document);</script></div><script type=module>
    import { searchbox } from "https://coco.infini.cloud/integration/cvn0g9ehpcehvsthrakg/widget";
    searchbox({container: "#searchbox"});
</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#object-relational-mapping>Object-Relational Mapping</a><ul><li><a href=#object-definition>Object Definition</a><ul><li><a href=#key-principle-ormobjectbase-inheritance>Key Principle: ORMObjectBase Inheritance</a></li><li><a href=#basic-object-structure>Basic Object Structure</a></li><li><a href=#nested-inheritance-building-on-base-objects>Nested Inheritance: Building on Base Objects</a></li><li><a href=#advanced-object-definition-with-elasticsearch-mapping>Advanced Object Definition with Elasticsearch Mapping</a></li></ul></li><li><a href=#object-registration>Object Registration</a><ul><li><a href=#simple-registration>Simple Registration</a></li><li><a href=#registration-with-context>Registration with Context</a></li></ul></li><li><a href=#elasticsearch-mapping-with-elastic_mapping>Elasticsearch Mapping with elastic_mapping</a><ul><li><a href=#common-mapping-parameters>Common Mapping Parameters</a></li><li><a href=#advanced-mapping-options>Advanced Mapping Options</a></li><li><a href=#real-world-datasource-example>Real-World DataSource Example</a></li></ul></li><li><a href=#crud-operations>CRUD Operations</a><ul><li><a href=#create-create>Create (Create)</a></li><li><a href=#read-get>Read (Get)</a></li><li><a href=#update-updateupsert>Update (Update/Upsert)</a></li><li><a href=#delete-delete>Delete (Delete)</a></li></ul></li><li><a href=#advanced-operations>Advanced Operations</a><ul><li><a href=#search-with-query-builder>Search with Query Builder</a></li><li><a href=#complex-search-with-text-queries>Complex Search with Text Queries</a></li><li><a href=#delete-by-query>Delete by Query</a></li></ul></li><li><a href=#context-options>Context Options</a></li><li><a href=#real-world-example-datasource-module>Real-World Example: DataSource Module</a></li></ul></li></ul></nav></aside></main></body></html>