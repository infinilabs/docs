<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>搜索管道 on INFINI Easysearch (main)</title><link>/easysearch/main/docs/features/query-dsl/search-pipelines/</link><description>Recent content in 搜索管道 on INFINI Easysearch (main)</description><generator>Hugo -- gohugo.io</generator><atom:link href="/easysearch/main/docs/features/query-dsl/search-pipelines/index.xml" rel="self" type="application/rss+xml"/><item><title>过滤查询处理器</title><link>/easysearch/main/docs/features/query-dsl/search-pipelines/filter-query-processor/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/features/query-dsl/search-pipelines/filter-query-processor/</guid><description>过滤查询处理器（filter query processor） # 版本引入：1.14.0
filter_query 查询重写处理器用于拦截搜索请求，并向该请求中添加一个额外的查询条件，从而对搜索结果进行过滤。当你不希望重写应用程序中已有的查询语句，但又需要对结果进行额外过滤时，此功能非常有用。
请求体字段 # 下表列出了所有可用的请求字段。
字段 数据类型 说明 query 对象 使用 Easysearch 查询领域特定语言（DSL）编写的查询语句。必填。 tag 字符串 处理器的唯一标识符。可选。 description 字符串 对该处理器的描述信息。可选。 ignore_failure 布尔值 若为 true，则当此处理器执行失败时，Easysearch 将忽略该错误并继续执行搜索管道中的其余处理器。可选，默认值为 false。 示例 # 以下示例演示如何在搜索管道中使用 filter_query 处理器。
准备工作 # 创建一个名为 my_index 的索引，并索引两个文档：一个公开，一个私有：
POST /my_index/_doc/1 { &amp;#34;message&amp;#34;: &amp;#34;This is a public message&amp;#34;, &amp;#34;visibility&amp;#34;: &amp;#34;public&amp;#34; } POST /my_index/_doc/2 { &amp;#34;message&amp;#34;: &amp;#34;This is a private message&amp;#34;, &amp;#34;visibility&amp;#34;: &amp;#34;private&amp;#34; } 创建搜索管道 # 以下请求创建一个名为 my_pipeline 的搜索管道，其中包含一个 filter_query 查询重写处理器。该处理器使用 term 查询，仅返回可见性为“public”的文档：</description></item><item><title>重命名字段处理器</title><link>/easysearch/main/docs/features/query-dsl/search-pipelines/rename-field-processor/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/features/query-dsl/search-pipelines/rename-field-processor/</guid><description>重命名字段处理器（Rename Field Processor） # 版本引入：1.14.0
rename_field 结果增强处理器用于拦截搜索响应，并对指定字段进行重命名。当你索引中的字段名称与应用程序使用的名称不一致时，该功能非常有用。例如，当索引中使用了新的字段名称，但应用程序仍期望接收旧字段名称时，可通过 rename_field 处理器在返回响应前完成字段名的映射，实现平滑过渡和向后兼容。
请求体字段 # 下表列出了该处理器支持的所有配置字段。
字段 数据类型 说明 field 字符串 要重命名的原始字段名。必填。 target_field 字符串 新的字段名称。必填。 tag 字符串 处理器的唯一标识符。可选。 description 字符串 对该处理器的描述信息。可选。 ignore_failure 布尔值 若为 true，当此处理器执行失败时，Easysearch 将忽略错误并继续执行搜索管道中的其余处理器。可选，默认值为 false。 示例 # 以下示例演示如何在搜索管道中使用 rename_field 处理器。
准备工作 # 创建一个名为 my_index 的索引，并索引一个包含 message 字段的文档：
POST /my_index/_doc/1 { &amp;#34;message&amp;#34;: &amp;#34;This is a public message&amp;#34;, &amp;#34;visibility&amp;#34;: &amp;#34;public&amp;#34; } 创建搜索管道 # 以下请求创建一个名为 my_pipeline 的搜索管道，其中包含一个 rename_field 结果增强处理器，用于将字段 message 重命名为 notification：</description></item><item><title>脚本处理器</title><link>/easysearch/main/docs/features/query-dsl/search-pipelines/script-processor/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/features/query-dsl/search-pipelines/script-processor/</guid><description>脚本处理器（Script Processor） # 版本引入：1.14.0
script 查询重写处理器用于拦截搜索请求，并在请求中添加一个内联的 Painless 脚本，该脚本会在接收到请求时执行。脚本仅能操作以下请求字段：
from size explain version seq_no_primary_term track_scores track_total_hits min_score terminate_after profile 请求体字段 # 下表列出了该处理器支持的所有配置字段。
字段 数据类型 说明 source 内联脚本 要执行的脚本代码。必填。 lang 字符串 脚本语言。可选，默认为 painless，目前仅支持 painless。 tag 字符串 处理器的唯一标识符，用于调试或跟踪。可选。 description 字符串 对该处理器的描述信息。可选。 ignore_failure 布尔值 若为 true，当此处理器执行失败时，Easysearch 将忽略错误并继续执行后续处理器。可选，默认值为 false。 示例 # 以下请求创建一个名为 explain_one_result 的搜索管道，其中包含一个 script 查询重写处理器。该脚本的作用是：当请求返回多个结果时自动关闭 explain 功能，因为 explain 是一项开销较大的操作；仅在返回单个结果时启用。</description></item><item><title>语义查询增强处理器</title><link>/easysearch/main/docs/features/query-dsl/search-pipelines/semantic-query-enricher-processor/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/features/query-dsl/search-pipelines/semantic-query-enricher-processor/</guid><description>语义查询增强处理器（Semantic Query Enricher Processor） # 需要 AI 插件
semantic_query_enricher 查询重写处理器用于拦截搜索请求，自动为其中的语义查询（semantic / hybrid 等基于 Embedding 模型的查询）注入模型连接信息（URL、API Key、vendor、model ID），使用户在编写查询时无需手动指定这些参数。
工作原理 # 当搜索请求到达管道时，处理器会遍历查询树，找到所有继承自 ModelBaseQueryBuilder 的查询节点（如 semantic 查询、hybrid 查询中的语义子查询），并为它们绑定 Embedding 请求参数：
从处理器配置中读取 url、vendor、api_key 根据 default_model_id 或 vector_field_model_id 为每个语义查询字段分配模型 ID 用户只需在查询中写 semantic 查询和查询文本，无需关心模型连接细节 请求体字段 # 字段 类型 是否必填 说明 url String 是 Embedding 模型服务的 URL vendor String 是 模型提供商标识（如 openai、dashscope、ollama 等） api_key String 否 模型服务的 API Key。存储时会自动加密 default_model_id String 条件必填 默认模型 ID，应用于所有未指定模型的语义查询字段。与 vector_field_model_id 至少提供一个 vector_field_model_id Object 条件必填 按向量字段指定模型 ID 的映射。格式：{&amp;quot;field_name&amp;quot;: &amp;quot;model_id&amp;quot;}。与 default_model_id 至少提供一个 tag String 否 处理器标识标签 description String 否 处理器描述 ignore_failure Boolean 否 处理器失败时是否继续执行。默认 false 示例 # 使用全局默认模型 # PUT /_search/pipeline/my_semantic_pipeline { &amp;#34;rewrite_processors&amp;#34;: [ { &amp;#34;semantic_query_enricher&amp;#34;: { &amp;#34;tag&amp;#34;: &amp;#34;enricher&amp;#34;, &amp;#34;description&amp;#34;: &amp;#34;为语义查询注入 Embedding 模型信息&amp;#34;, &amp;#34;url&amp;#34;: &amp;#34;https://dashscope.</description></item><item><title>混合搜索排序处理器</title><link>/easysearch/main/docs/features/query-dsl/search-pipelines/hybrid-ranker-processor/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/features/query-dsl/search-pipelines/hybrid-ranker-processor/</guid><description>混合搜索排序处理器（Hybrid Ranker Processor） # 需要 AI 插件
hybrid_ranker_processor 是一种搜索阶段结果处理器（search phase results processor），运行于 Query 阶段和 Fetch 阶段之间，用于对混合搜索（hybrid 查询）返回的多路子查询得分进行归一化和融合，生成统一的最终得分排序。
工作原理 # 在混合搜索中，多个子查询（如 BM25 关键词查询 + KNN 向量查询）各自返回独立的得分。这些得分的量纲和分布可能完全不同，无法直接比较。hybrid_ranker_processor 通过以下步骤解决这个问题：
得分归一化：将各子查询的得分归一化到可比较的范围 得分融合：使用融合算法（如 RRF）将多路归一化后的得分合并为统一的最终得分 根据最终得分重新排序搜索结果 RRF 算法 # 默认使用 Reciprocal Rank Fusion (RRF) 算法，其核心思想是基于排名而非原始分数进行融合：
$$\text{RRF}(d) = \sum_{i=1}^{n} \frac{1}{k + r_i(d)}$$
其中 $k$ 为常数（默认 60），$r_i(d)$ 为文档 $d$ 在第 $i$ 个子查询结果中的排名。
请求体字段 # 字段 类型 是否必填 说明 combination Object 否 得分融合配置 combination.</description></item><item><title>混合评分解释处理器</title><link>/easysearch/main/docs/features/query-dsl/search-pipelines/hybrid-score-explanation-processor/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/features/query-dsl/search-pipelines/hybrid-score-explanation-processor/</guid><description>混合评分解释处理器（Hybrid Score Explanation Processor） # 需要 AI 插件
hybrid_score_explanation 响应处理器用于为混合搜索结果添加评分解释信息。当与 hybrid_ranker_processor 配合使用时，该处理器将归一化和得分融合的详细过程附加到每个搜索命中结果中，帮助用户理解最终得分的来源。
工作原理 # 在混合搜索管道中，hybrid_ranker_processor 在得分融合过程中会将详细的计算信息（各子查询的原始得分、归一化方式、融合方式）记录到管道处理上下文中。hybrid_score_explanation 处理器在响应阶段读取这些信息，并将其合并到每个搜索命中结果的 _explanation 字段中。
解释信息包括：
归一化详情：使用的归一化技术及每个子查询得分的归一化结果 得分融合详情：使用的融合算法（如 RRF）及各路得分的融合过程 请求体字段 # 字段 类型 是否必填 说明 tag String 否 处理器标识标签 description String 否 处理器描述 ignore_failure Boolean 否 处理器失败时是否继续执行。默认 false 示例 # 基本用法 # PUT /_search/pipeline/my_explain_pipeline { &amp;#34;phase_results_processors&amp;#34;: [ { &amp;#34;hybrid_ranker_processor&amp;#34;: { &amp;#34;tag&amp;#34;: &amp;#34;ranker&amp;#34;, &amp;#34;description&amp;#34;: &amp;#34;RRF 混合排序&amp;#34; } } ], &amp;#34;response_processors&amp;#34;: [ { &amp;#34;hybrid_score_explanation&amp;#34;: { &amp;#34;tag&amp;#34;: &amp;#34;explanation&amp;#34;, &amp;#34;description&amp;#34;: &amp;#34;添加混合评分解释&amp;#34; } } ] } 返回结果示例 # 使用上述管道执行混合搜索后，每个命中结果的 _explanation 中会包含类似以下的评分解释：</description></item></channel></rss>