<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>脚本 on INFINI Easysearch</title><link>/easysearch/main/docs/features/scripting/</link><description>Recent content in 脚本 on INFINI Easysearch</description><generator>Hugo -- gohugo.io</generator><atom:link href="/easysearch/main/docs/features/scripting/index.xml" rel="self" type="application/rss+xml"/><item><title>Painless 脚本语言</title><link>/easysearch/main/docs/features/scripting/painless/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/features/scripting/painless/</guid><description>Painless 脚本语言 # Painless 是 Easysearch 内置的高性能脚本语言，也是默认脚本语言。它专为搜索引擎场景设计，具备以下特点：
高性能：编译为 Java 字节码，通过 JIT 直接在 JVM 上运行 安全沙盒：只允许访问白名单内的 Java API，无法执行文件、网络等危险操作 Java 风格语法：对 Java 开发者友好，学习成本低 专用优化：内置 doc、_source、ctx 等快捷访问方式 基本语法 # 变量与类型 # Painless 是强类型语言，支持类型推断：
// 显式类型声明 int count = 10; double price = 99.5; String name = &amp;#34;Easysearch&amp;#34;; boolean active = true; // 类型推断（使用 def） def value = doc[&amp;#39;price&amp;#39;].value; def list = [1, 2, 3]; def map = [&amp;#39;key&amp;#39;: &amp;#39;value&amp;#39;, &amp;#39;count&amp;#39;: 42]; 支持的基本类型：</description></item><item><title>Painless 常用示例</title><link>/easysearch/main/docs/features/scripting/painless-examples/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/features/scripting/painless-examples/</guid><description>Painless 常用示例 # 本页收集了各种场景下常用的 Painless 脚本示例，可直接复制使用或按需修改。
脚本字段（Script Fields） # 在搜索结果中返回动态计算的字段值。
计算折扣价格 # GET products/_search { &amp;#34;query&amp;#34;: { &amp;#34;match_all&amp;#34;: {} }, &amp;#34;script_fields&amp;#34;: { &amp;#34;discounted_price&amp;#34;: { &amp;#34;script&amp;#34;: { &amp;#34;source&amp;#34;: &amp;#34;doc[&amp;#39;price&amp;#39;].value * (1 - params.discount)&amp;#34;, &amp;#34;params&amp;#34;: { &amp;#34;discount&amp;#34;: 0.2 } } } } } 拼接姓名字段 # GET employees/_search { &amp;#34;script_fields&amp;#34;: { &amp;#34;full_name&amp;#34;: { &amp;#34;script&amp;#34;: { &amp;#34;source&amp;#34;: &amp;#34;&amp;#34;&amp;#34; def first = doc[&amp;#39;first_name.keyword&amp;#39;].size() &amp;gt; 0 ? doc[&amp;#39;first_name.keyword&amp;#39;].value : &amp;#39;&amp;#39;; def last = doc[&amp;#39;last_name.</description></item><item><title>存储脚本</title><link>/easysearch/main/docs/features/scripting/stored-scripts/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/features/scripting/stored-scripts/</guid><description>存储脚本 # 存储脚本（Stored Scripts）允许您将常用的脚本预先保存在集群中，之后通过 ID 引用执行。使用存储脚本可以减少请求体大小、避免重复编译、并集中管理脚本逻辑。
创建存储脚本 # 使用 POST _scripts/&amp;lt;script_id&amp;gt; 创建或更新存储脚本：
POST _scripts/calculate_discount { &amp;#34;script&amp;#34;: { &amp;#34;lang&amp;#34;: &amp;#34;painless&amp;#34;, &amp;#34;source&amp;#34;: &amp;#34;doc[&amp;#39;price&amp;#39;].value * (1 - params.discount_rate)&amp;#34; } } 指定脚本上下文 # 可以在创建时指定脚本的使用上下文，Easysearch 会在存储时进行上下文相关的语法校验：
POST _scripts/my_score_script/score { &amp;#34;script&amp;#34;: { &amp;#34;lang&amp;#34;: &amp;#34;painless&amp;#34;, &amp;#34;source&amp;#34;: &amp;#34;_score * doc[&amp;#39;boost&amp;#39;].value&amp;#34; } } 上下文名称放在 URL 路径的第二段（/score），可选值包括：score、filter、update、ingest 等。
获取存储脚本 # GET _scripts/calculate_discount 响应：
{ &amp;#34;_id&amp;#34;: &amp;#34;calculate_discount&amp;#34;, &amp;#34;found&amp;#34;: true, &amp;#34;script&amp;#34;: { &amp;#34;lang&amp;#34;: &amp;#34;painless&amp;#34;, &amp;#34;source&amp;#34;: &amp;#34;doc[&amp;#39;price&amp;#39;].value * (1 - params.</description></item><item><title>Lucene 表达式</title><link>/easysearch/main/docs/features/scripting/expressions/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/features/scripting/expressions/</guid><description>Lucene 表达式 脚本语言 # Lucene Expressions 是一种轻量级的数学表达式脚本语言，编译为 Java 字节码，性能极高。适用于简单的数值计算场景，如自定义排序和评分。
特点 # 特性 说明 性能 极高，直接编译为字节码，无解释器开销 安全 完全沙盒，只能进行数学运算 功能范围 仅支持数值运算和比较 数据访问 只能访问 doc values（doc['field']） 返回类型 始终返回 double 语法 # 基本运算 # doc[&amp;#39;price&amp;#39;].value * 0.9 doc[&amp;#39;score&amp;#39;].value + doc[&amp;#39;bonus&amp;#39;].value (doc[&amp;#39;a&amp;#39;].value + doc[&amp;#39;b&amp;#39;].value) / 2 数学函数 # 函数 说明 示例 abs(x) 绝对值 abs(doc['delta'].</description></item></channel></rss>