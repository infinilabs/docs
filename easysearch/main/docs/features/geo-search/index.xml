<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>地理位置搜索 on INFINI Easysearch (main)</title><link>/easysearch/main/docs/features/geo-search/</link><description>Recent content in 地理位置搜索 on INFINI Easysearch (main)</description><generator>Hugo -- gohugo.io</generator><atom:link href="/easysearch/main/docs/features/geo-search/index.xml" rel="self" type="application/rss+xml"/><item><title>Geo Bounding Box 查询</title><link>/easysearch/main/docs/features/geo-search/geo-bounding-box/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/features/geo-search/geo-bounding-box/</guid><description>地理边界框查询返回 geo_point 字段值位于指定矩形边界框内的文档。如果一个文档包含多个地理坐标点，只要至少有一个点位于边界框内，该文档就匹配。
参考样例 # 您可以使用地理边界框查询来搜索包含地理点的文档。
创建一个映射，将 point 字段映射为 geo_point ：
PUT testindex1 { &amp;#34;mappings&amp;#34;: { &amp;#34;properties&amp;#34;: { &amp;#34;point&amp;#34;: { &amp;#34;type&amp;#34;: &amp;#34;geo_point&amp;#34; } } } } 以经纬度作为对象索引三个地理点：
PUT testindex1/_doc/1 { &amp;#34;point&amp;#34;: { &amp;#34;lat&amp;#34;: 74.00, &amp;#34;lon&amp;#34;: 40.71 } } PUT testindex1/_doc/2 { &amp;#34;point&amp;#34;: { &amp;#34;lat&amp;#34;: 72.64, &amp;#34;lon&amp;#34;: 22.62 } } PUT testindex1/_doc/3 { &amp;#34;point&amp;#34;: { &amp;#34;lat&amp;#34;: 75.00, &amp;#34;lon&amp;#34;: 28.00 } } 搜索所有文档，并筛选出查询中定义的矩形内的点所在的文档：
GET testindex1/_search { &amp;#34;query&amp;#34;: { &amp;#34;bool&amp;#34;: { &amp;#34;must&amp;#34;: { &amp;#34;match_all&amp;#34;: {} }, &amp;#34;filter&amp;#34;: { &amp;#34;geo_bounding_box&amp;#34;: { &amp;#34;point&amp;#34;: { &amp;#34;top_left&amp;#34;: { &amp;#34;lat&amp;#34;: 75, &amp;#34;lon&amp;#34;: 28 }, &amp;#34;bottom_right&amp;#34;: { &amp;#34;lat&amp;#34;: 73, &amp;#34;lon&amp;#34;: 41 } } } } } } } 返回内容包含匹配的文档：</description></item><item><title>Geo Distance 查询</title><link>/easysearch/main/docs/features/geo-search/geo-distance/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/features/geo-search/geo-distance/</guid><description>地理距离查询返回 geo_point 字段值位于指定中心点给定距离范围内的文档。如果一个文档包含多个地理坐标点，只要至少有一个点在距离范围内，该文档就匹配。
参考样例 # 创建一个映射，将 point 字段映射为 geo_point ：
PUT testindex1 { &amp;#34;mappings&amp;#34;: { &amp;#34;properties&amp;#34;: { &amp;#34;point&amp;#34;: { &amp;#34;type&amp;#34;: &amp;#34;geo_point&amp;#34; } } } } 索引一个地理点，指定其纬度和经度：
PUT testindex1/_doc/1 { &amp;#34;point&amp;#34;: { &amp;#34;lat&amp;#34;: 74.00, &amp;#34;lon&amp;#34;: 40.71 } } 搜索距离指定的 point 内包含指定 distance 对象的文档：
GET /testindex1/_search { &amp;#34;query&amp;#34;: { &amp;#34;bool&amp;#34;: { &amp;#34;must&amp;#34;: { &amp;#34;match_all&amp;#34;: {} }, &amp;#34;filter&amp;#34;: { &amp;#34;geo_distance&amp;#34;: { &amp;#34;distance&amp;#34;: &amp;#34;50mi&amp;#34;, &amp;#34;point&amp;#34;: { &amp;#34;lat&amp;#34;: 73.5, &amp;#34;lon&amp;#34;: 40.5 } } } } } } 返回内容包含匹配的文档：</description></item><item><title>Geo Polygon 查询</title><link>/easysearch/main/docs/features/geo-search/geo-polygon/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/features/geo-search/geo-polygon/</guid><description>地理多边形查询返回 geo_point 字段值位于指定多边形内的文档。如果一个文档包含多个地理坐标点，只要至少有一个点在多边形内，该文档就匹配。
多边形通过坐标顶点列表指定，不需要闭合（首尾相同不是必须的），但建议按顺时针或逆时针顺序列出。
参考样例 # 创建一个映射，将 point 字段映射为 geo_point ：
PUT /testindex1 { &amp;#34;mappings&amp;#34;: { &amp;#34;properties&amp;#34;: { &amp;#34;point&amp;#34;: { &amp;#34;type&amp;#34;: &amp;#34;geo_point&amp;#34; } } } } 索引一个地理点，指定其纬度和经度：
PUT testindex1/_doc/1 { &amp;#34;point&amp;#34;: { &amp;#34;lat&amp;#34;: 73.71, &amp;#34;lon&amp;#34;: 41.32 } } 搜索包含指定 geo_polygon 的 point 对象的文档：
GET /testindex1/_search { &amp;#34;query&amp;#34;: { &amp;#34;bool&amp;#34;: { &amp;#34;must&amp;#34;: { &amp;#34;match_all&amp;#34;: {} }, &amp;#34;filter&amp;#34;: { &amp;#34;geo_polygon&amp;#34;: { &amp;#34;point&amp;#34;: { &amp;#34;points&amp;#34;: [ { &amp;#34;lat&amp;#34;: 74.5627, &amp;#34;lon&amp;#34;: 41.8645 }, { &amp;#34;lat&amp;#34;: 73.</description></item><item><title>Geo Shape 查询</title><link>/easysearch/main/docs/features/geo-search/geo-shape-query/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/features/geo-search/geo-shape-query/</guid><description>地理形状查询用于搜索 geo_point 或 geo_shape 字段的文档。可以使用查询中内联定义的形状，或引用预索引的形状来过滤文档。
空间关系 # 当您向地理形状查询提供地理形状时，文档中的地理点和地理形状字段将使用以下空间关系与提供的形状进行匹配。
关系 描述 支持地理字段类型 INTERSECTS （默认）匹配与查询中提供的形状相交的 geopoint 或 geoshape 的文档。 geo_point, geo_shape DISJOINT 匹配与查询中提供的形状不相交的 geoshape 的文档。 geo_shape WITHIN 匹配完全位于查询中提供的形状内的 geoshape 的文档。 geo_shape CONTAINS 匹配完全包含查询中提供的形状的文档。 geo_shape 在 geoshape 查询中定义形状 # 您可以在 geoshape 查询中通过在查询时提供新的形状定义或引用另一个索引中预先索引的形状名称来定义形状以过滤文档。
使用新的形状定义 # 为了向地理形状查询提供新的形状，请在 geo_shape 字段中定义它。您必须以 GeoJSON 格式定义地理形状。
以下示例说明了搜索包含在查询时定义的地理形状的文档。
首先，创建一个索引并将 location 字段映射为 geo_shape ：</description></item><item><title>地理位置实践</title><link>/easysearch/main/docs/features/geo-search/geo-recipes/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/features/geo-search/geo-recipes/</guid><description>本页以“场景实践”的形式给出几个常见地理位置需求下的解决方案，帮助你在实际应用中更好地使用地理位置功能。
在具体 API 上，Easysearch 主要通过：
geo_distance / _geo_distance：按距离过滤与排序 geo_shape：做复杂形状的围栏与空间关系判断 geohash_grid / geo_bounds：在地图上做网格聚合与视野控制 下面的配方会围绕这些能力展开。
地理位置聚合 # 虽然按照地理位置对结果进行过滤或者打分很有用，但是在地图上呈现信息给用户通常更加有用。一个查询可能会返回太多结果以至于不能单独地展现每一个地理坐标点，但是地理位置聚合可以用来将地理坐标聚集到更加容易管理的 buckets 中。
处理 geo_point 类型字段的三种聚合：
地理距离聚合 # geo_distance 聚合对一些搜索非常有用，例如找到所有距离我 1km 以内的披萨店。搜索结果应该也的确被限制在用户指定 1km 范围内，但是我们可以添加在 2km 范围内找到的其他结果：
GET /attractions/_search { &amp;#34;query&amp;#34;: { &amp;#34;bool&amp;#34;: { &amp;#34;must&amp;#34;: { &amp;#34;match&amp;#34;: { &amp;#34;name&amp;#34;: &amp;#34;pizza&amp;#34; } }, &amp;#34;filter&amp;#34;: { &amp;#34;geo_bounding_box&amp;#34;: { &amp;#34;location&amp;#34;: { &amp;#34;top_left&amp;#34;: { &amp;#34;lat&amp;#34;: 40.8, &amp;#34;lon&amp;#34;: -74.1 }, &amp;#34;bottom_right&amp;#34;: { &amp;#34;lat&amp;#34;: 40.4, &amp;#34;lon&amp;#34;: -73.7 } } } } } }, &amp;#34;aggs&amp;#34;: { &amp;#34;per_ring&amp;#34;: { &amp;#34;geo_distance&amp;#34;: { &amp;#34;field&amp;#34;: &amp;#34;location&amp;#34;, &amp;#34;unit&amp;#34;: &amp;#34;km&amp;#34;, &amp;#34;origin&amp;#34;: { &amp;#34;lat&amp;#34;: 40.</description></item></channel></rss>