<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>指标聚合 on INFINI Easysearch</title><link>/easysearch/main/docs/references/aggregation/metric-aggregations/</link><description>Recent content in 指标聚合 on INFINI Easysearch</description><generator>Hugo -- gohugo.io</generator><atom:link href="/easysearch/main/docs/references/aggregation/metric-aggregations/index.xml" rel="self" type="application/rss+xml"/><item><title>Top 汇总</title><link>/easysearch/main/docs/references/aggregation/metric-aggregations/top-hits/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/references/aggregation/metric-aggregations/top-hits/</guid><description>Top 汇总 # top_hits 指标是一种多值指标汇总，它根据聚合字段的相关性评分对匹配文档进行排名。
您可以指定以下选项：
from : 命中的起始位置。 size : 返回命中的最大数量。默认值为 3。 sort : 匹配命中的排序方式。默认情况下，命中的排序依据聚合查询的相关性得分。 以下示例返回数据中的前 5 个产品：
GET sample_data_ecommerce/_search { &amp;quot;size&amp;quot;: 0, &amp;quot;aggs&amp;quot;: { &amp;quot;top_hits_products&amp;quot;: { &amp;quot;top_hits&amp;quot;: { &amp;quot;size&amp;quot;: 5 } } } } 返回内容
... &amp;quot;aggregations&amp;quot; : { &amp;quot;top_hits_products&amp;quot; : { &amp;quot;hits&amp;quot; : { &amp;quot;total&amp;quot; : { &amp;quot;value&amp;quot; : 4675, &amp;quot;relation&amp;quot; : &amp;quot;eq&amp;quot; }, &amp;quot;max_score&amp;quot; : 1.0, &amp;quot;hits&amp;quot; : [ { &amp;quot;_index&amp;quot; : &amp;quot;sample_data_ecommerce&amp;quot;, &amp;quot;_type&amp;quot; : &amp;quot;_doc&amp;quot;, &amp;quot;_id&amp;quot; : &amp;quot;glMlwXcBQVLeQPrkHPtI&amp;quot;, &amp;quot;_score&amp;quot; : 1.</description></item><item><title>中位数绝对偏差聚合</title><link>/easysearch/main/docs/references/aggregation/metric-aggregations/median-absolute-deviation/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/references/aggregation/metric-aggregations/median-absolute-deviation/</guid><description>中位数绝对偏差聚合 # median_absolute_deviation 中位数绝对偏差聚合是一个单值指标聚合。中位数绝对偏差是一种变异性指标，用于衡量相对于中位数的离散程度。
与依赖平方误差项的标准偏差相比，中位数绝对偏差受异常值的影响较小，适用于描述非正态分布的数据。
中位数绝对偏差按以下方式计算：
median_absolute_deviation = median( | x&amp;lt;sub&amp;gt;i&amp;lt;/sub&amp;gt; - median(x&amp;lt;sub&amp;gt;i&amp;lt;/sub&amp;gt;) | )
由于内存限制，Easysearch 估计 median_absolute_deviation ，而不是直接计算它。这种估计在计算上很昂贵。您可以调整估计精度和性能之间的权衡。有关更多信息，请参阅调整估计精度。
参数说明 # median_absolute_deviation 聚合采用以下参数。
参数 必需/可选 数据类型 描述 field 必需 String 要计算中位数绝对偏差的数值字段的名称。 missing 可选 Numeric 分配给字段缺失实例的值。如果未提供，则从估计中排除具有缺失值的文档。 compression 可选 Numeric 一个调整估计精度和性能之间平衡的参数。 compression 的值必须大于 0 。默认值为 1000 。 参考样例 # 以下示例计算数据集中 DistanceMiles 字段的绝对中位数偏差：
GET sample_data_flights/_search { &amp;quot;size&amp;quot;: 0, &amp;quot;aggs&amp;quot;: { &amp;quot;median_absolute_deviation_DistanceMiles&amp;quot;: { &amp;quot;median_absolute_deviation&amp;quot;: { &amp;quot;field&amp;quot;: &amp;quot;DistanceMiles&amp;quot; } } } } 返回内容 # 如以下返回内容所示，聚合返回了 median_absolute_deviation_DistanceMiles 变量中绝对中位数偏差的估计值：</description></item><item><title>值计数聚合</title><link>/easysearch/main/docs/references/aggregation/metric-aggregations/value-count/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/references/aggregation/metric-aggregations/value-count/</guid><description>值计数聚合 # value_count 值计数聚合是一个单值指标聚合，用于计算聚合所基于的值的数量。 例如，您可以将 value_count 指标与 avg 指标一起使用来查找聚合使用多少个数字来计算平均值。
GET sample_data_ecommerce/_search { &amp;quot;size&amp;quot;: 0, &amp;quot;aggs&amp;quot;: { &amp;quot;number_of_values&amp;quot;: { &amp;quot;value_count&amp;quot;: { &amp;quot;field&amp;quot;: &amp;quot;taxful_total_price&amp;quot; } } } } 返回内容
... &amp;quot;aggregations&amp;quot; : { &amp;quot;number_of_values&amp;quot; : { &amp;quot;value&amp;quot; : 4675 } } }</description></item><item><title>加权平均聚合</title><link>/easysearch/main/docs/references/aggregation/metric-aggregations/weighted-avg/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/references/aggregation/metric-aggregations/weighted-avg/</guid><description>加权平均聚合 # weighted_avg 聚合计算跨文档数值的加权平均值。当您想计算平均值，但希望某些数据点的权重大于其他数据点时，此功能非常有用。
加权平均值使用公式 $\frac{\sum_{i=1}^n value_i \cdot weight_i}{\sum_{i=1}^n weight_i}$ 计算。
参数说明 # weighted_avg 聚合采用以下参数。
参数 必需/可选 描述 value 必需 定义如何获取要计算平均值的数值。需要 field 或 script 。 weight 必需 定义如何获取每个值的权重。需要 field 或 script 。 format 可选 DecimalFormat 格式字符串。返回聚合的 value_as_string 属性中的格式化输出。 value_type 可选 使用脚本或未映射字段时的值的类型提示。 可以在 value 或 weight 内指定以下参数。
参数 必需/可选 描述 field 可选 用于值或权重的文档字段。 missing 可选 字段缺失时使用的默认值或权重。请参阅缺失值。 参考样例 # 首先，创建索引并索引一些数据。请注意，产品 C 缺少 rating 和 num_reviews 字段：</description></item><item><title>地理中心点</title><link>/easysearch/main/docs/references/aggregation/metric-aggregations/geocentroid/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/references/aggregation/metric-aggregations/geocentroid/</guid><description>地理中心点 # geo_centroid 地理中心点的聚合计算一组 geo_point 值的地理中心或焦点。它将中心位置作为纬度-经度对返回。
参数说明 # geo_centroid 聚合采用以下参数。
参数 必需/可选 数据类型 描述 field 必需 String 包含计算中心的地理点的字段的名称。 参考样例 # 以下示例返回数据中每个订单的 geo_centroid 的 geoip.location 。每个 geoip.location 都是一个地理点：
GET /sample_data_ecommerce/_search { &amp;quot;size&amp;quot;: 0, &amp;quot;aggs&amp;quot;: { &amp;quot;centroid&amp;quot;: { &amp;quot;geo_centroid&amp;quot;: { &amp;quot;field&amp;quot;: &amp;quot;geoip.location&amp;quot; } } } } 返回内容 # 返回内容包括一个 centroid 对象，该对象具有 lat 和 lon 属性，表示所有索引数据点的中心位置：
{ &amp;quot;took&amp;quot;: 35, &amp;quot;timed_out&amp;quot;: false, &amp;quot;_shards&amp;quot;: { &amp;quot;total&amp;quot;: 1, &amp;quot;successful&amp;quot;: 1, &amp;quot;skipped&amp;quot;: 0, &amp;quot;failed&amp;quot;: 0 }, &amp;quot;hits&amp;quot;: { &amp;quot;total&amp;quot;: { &amp;quot;value&amp;quot;: 4675, &amp;quot;relation&amp;quot;: &amp;quot;eq&amp;quot; }, &amp;quot;max_score&amp;quot;: null, &amp;quot;hits&amp;quot;: [] }, &amp;quot;aggregations&amp;quot;: { &amp;quot;centroid&amp;quot;: { &amp;quot;location&amp;quot;: { &amp;quot;lat&amp;quot;: 35.</description></item><item><title>地理边界聚合</title><link>/easysearch/main/docs/references/aggregation/metric-aggregations/geobounds/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/references/aggregation/metric-aggregations/geobounds/</guid><description>地理边界聚合 # geo_bounds 地理边界聚合是一个多值聚合，用于计算包含一组 geo_point 或 geo_shape 对象的地理边界框。边界框以十进制编码的经纬度（lat-lon）对形式返回，作为矩形的左上角和右下角顶点。
参数说明 # geo_bounds 聚合采用以下参数。
参数 必需/可选 数据类型 描述 field 必需 String 计算地理边界所使用的包含地理点或地理形状的字段的名称。 wrap_longitude 可选 Boolean 是否允许边界框与国际日期变更线重叠。默认值为 true 。 参考样例 # 以下示例查询数据中每个订单的 geo_bounds 的 geoip.location （每个 geoip.location 是一个地理点）：
GET sample_data_ecommerce/_search { &amp;quot;size&amp;quot;: 0, &amp;quot;aggs&amp;quot;: { &amp;quot;geo&amp;quot;: { &amp;quot;geo_bounds&amp;quot;: { &amp;quot;field&amp;quot;: &amp;quot;geoip.location&amp;quot; } } } } 返回内容 # 如以下示例响应所示，聚合返回包含 geoip.</description></item><item><title>基数聚合</title><link>/easysearch/main/docs/references/aggregation/metric-aggregations/cardinality/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/references/aggregation/metric-aggregations/cardinality/</guid><description>基数聚合 # cardinality 聚合是一种单值度量聚合，用于计算字段的唯一值或不同值的数量。
基数计数为近似值。有关更多信息，请参阅下面的控制精度 。
参数说明 # cardinality 聚合采用以下参数。
参数 必需/可选 数据类型 描述 field 必需的 String 估计基数的字段。 precision_threshold 可选 Numeric 阈值，低于该阈值的计数预计接近准确值。有关更多信息，请参阅控制精度 。 execution_hint 可选 String 如何运行聚合，该参数会影响资源使用和聚合效率。有效值为 ordinals 和 direct 。 missing 可选 与 field 类型相同 用于存储字段缺失实例的 bucket。如果未提供，则忽略缺失值。 参考样例 # 以下示例请求查找数据中唯一产品 ID 的数量：
GET sample_data_ecommerce/_search { &amp;quot;size&amp;quot;: 0, &amp;quot;aggs&amp;quot;: { &amp;quot;unique_products&amp;quot;: { &amp;quot;cardinality&amp;quot;: { &amp;quot;field&amp;quot;: &amp;quot;products.</description></item><item><title>平均聚合</title><link>/easysearch/main/docs/references/aggregation/metric-aggregations/average/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/references/aggregation/metric-aggregations/average/</guid><description>平均聚合 # avg 指标是一个单值指标，它返回某个字段的平均值。
参数说明 # avg 聚合采用以下参数。
参数 必需/可选 数据类型 描述 field 必需 String 计算平均值的字段。 missing 可选 Float 要分配给字段缺失实例的值。默认情况下， avg 会在计算中忽略缺失值。 参考样例 # 以下示例请求计算示例数据中 taxful_total_price 字段的平均值：
GET sample_data_ecommerce/_search { &amp;quot;size&amp;quot;: 0, &amp;quot;aggs&amp;quot;: { &amp;quot;avg_taxful_total_price&amp;quot;: { &amp;quot;avg&amp;quot;: { &amp;quot;field&amp;quot;: &amp;quot;taxful_total_price&amp;quot; } } } } 返回内容 # 返回内容包含 taxful_total_price 的平均值：
{ &amp;quot;took&amp;quot;: 85, &amp;quot;timed_out&amp;quot;: false, &amp;quot;_shards&amp;quot;: { &amp;quot;total&amp;quot;: 1, &amp;quot;successful&amp;quot;: 1, &amp;quot;skipped&amp;quot;: 0, &amp;quot;failed&amp;quot;: 0 }, &amp;quot;hits&amp;quot;: { &amp;quot;total&amp;quot;: { &amp;quot;value&amp;quot;: 4675, &amp;quot;relation&amp;quot;: &amp;quot;eq&amp;quot; }, &amp;quot;max_score&amp;quot;: null, &amp;quot;hits&amp;quot;: [] }, &amp;quot;aggregations&amp;quot;: { &amp;quot;avg_taxful_total_price&amp;quot;: { &amp;quot;value&amp;quot;: 75.</description></item><item><title>扩展统计聚合</title><link>/easysearch/main/docs/references/aggregation/metric-aggregations/extended-stats/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/references/aggregation/metric-aggregations/extended-stats/</guid><description>扩展统计聚合 # extended_stats 扩展统计聚合是统计数据 stats 聚合的更全面版本。除了统计数据提供的基本统计指标外，extended_stats 还计算以下内容：
平方和 方差 总体方差 抽样方差 标准差 总体标准差 抽样标准差 标准差界限： ** 上限 ** 下限 ** 总体上限 ** 总体下限 ** 抽样上限 ** 抽样下限 其中标准差和方差是总体统计量；它们分别始终等于总体标准差和方差。
std_deviation_bounds 对象定义了一个范围，该范围在均值（默认为两个标准差）的上方和下方跨越指定的标准差数量。此对象始终包含在输出中，但仅对正态分布的数据才有意义。在解释这些值之前，请验证您的数据集是否遵循正态分布。
参数说明 # extended_stats 聚合采用以下参数。
参数 必需/可选 数据类型 描述 field 必需 String 返回扩展统计信息的字段名称。 sigma 可选 Double（非负） 计算 std_deviation_bounds 区间所使用的均值上下标准差的数量。默认值为 2 。 missing 可选 Numeric 分配给字段缺失实例的值。如果未提供，包含缺失值的文档将不会出现在扩展统计中。 参考样例 # 以下示例请求数据中 taxful_total_price 的扩展统计信息：</description></item><item><title>最大值聚合</title><link>/easysearch/main/docs/references/aggregation/metric-aggregations/maximum/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/references/aggregation/metric-aggregations/maximum/</guid><description>最大值聚合 # max 最大值指标是一个单值指标，返回字段的最大值。
max 聚合使用 double （双精度）表示来比较数值字段。对于包含 long 或 unsigned_long 超过 2^53 的整数值的字段，结果应被视为近似值，因为 double 的尾数中的有效位数是 53。
参数说明 # max 聚合采用以下参数。
参数 必需/可选 数据类型 描述 field 必需 String 计算最大值的字段名称。 missing 可选 Numeric 分配给字段缺失实例的值。如果未提供，则包含缺失值的文档将从聚合中排除。 参考样例 # 以下示例请求在数据中查找最昂贵的商品——即 base_unit_price 值最大的商品：
GET sample_data_ecommerce/_search { &amp;quot;size&amp;quot;: 0, &amp;quot;aggs&amp;quot;: { &amp;quot;max_base_unit_price&amp;quot;: { &amp;quot;max&amp;quot;: { &amp;quot;field&amp;quot;: &amp;quot;products.base_unit_price&amp;quot; } } } } 返回内容 # 如以下示例返回内容所示，聚合返回 products.</description></item><item><title>最小值聚合</title><link>/easysearch/main/docs/references/aggregation/metric-aggregations/minimum/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/references/aggregation/metric-aggregations/minimum/</guid><description>最小值聚合 # min 最小值指标是一个单值指标，返回字段的最小值。
min 聚合使用 double （双精度）表示来比较数值字段。对于包含 long 或 unsigned_long 且绝对值大于 2 53 的字段，结果应被视为近似值，因为 double 尾数中的有效位数是 53。
参数说明 # min 聚合采用以下参数。
参数 必需/可选 数据类型 描述 field 必需 String 计算最小值的字段名称。 missing 可选 Numeric 分配给字段缺失实例的值。如果未提供，则包含缺失值的文档将从聚合中排除。 参考样例 # 以下示例请求在样本数据中查找最便宜的商品——即 base_unit_price 值最小的商品：
GET sample_data_ecommerce/_search { &amp;quot;size&amp;quot;: 0, &amp;quot;aggs&amp;quot;: { &amp;quot;min_base_unit_price&amp;quot;: { &amp;quot;min&amp;quot;: { &amp;quot;field&amp;quot;: &amp;quot;products.base_unit_price&amp;quot; } } } } 返回内容 # 如以下示例返回所示，聚合返回了 products.</description></item><item><title>求和聚合</title><link>/easysearch/main/docs/references/aggregation/metric-aggregations/sum/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/references/aggregation/metric-aggregations/sum/</guid><description>求和聚合 # sum 求和聚合是一种单值指标聚合，计算字段中匹配文档中提取的数值的总和。此聚合常用于计算诸如收入、数量或持续时间等指标的总计。
参数说明 # sum 聚合接受以下参数。
参数 必需/可选 数据类型 描述 field 必需 String 聚合的字段。必须是数值字段。 script 可选 Object 用于计算聚合自定义值的脚本。可以替代或与 field 结合使用。 missing 可选 Number 缺少目标字段时使用的默认值。 参考样例 # 以下示例演示了如何计算物流索引中记录的交付总重量。
创建一个索引：
PUT /deliveries { &amp;quot;mappings&amp;quot;: { &amp;quot;properties&amp;quot;: { &amp;quot;shipment_id&amp;quot;: { &amp;quot;type&amp;quot;: &amp;quot;keyword&amp;quot; }, &amp;quot;weight_kg&amp;quot;: { &amp;quot;type&amp;quot;: &amp;quot;double&amp;quot; } } } } 添加示例文档：
POST /deliveries/_bulk?refresh=true {&amp;quot;index&amp;quot;: {}} {&amp;quot;shipment_id&amp;quot;: &amp;quot;S001&amp;quot;, &amp;quot;weight_kg&amp;quot;: 12.</description></item><item><title>百分位排名聚合</title><link>/easysearch/main/docs/references/aggregation/metric-aggregations/percentile-ranks/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/references/aggregation/metric-aggregations/percentile-ranks/</guid><description>百分位排名聚合 # percentile_ranks 百分比排名聚合估计低于或等于给定阈值的观测值百分比。这对于了解特定值在值分布中的相对位置很有用。 例如，您可以使用百分位排名聚合来学习交易金额 45 与数据集中其他交易值相比如何。百分位排名聚合返回一个值，如 82.3 ，这意味着 82.3% 的交易额低于或等于 45 。
参数说明 # percentile_ranks 聚合采用以下参数。
参数 必需/可选 数据类型 描述 field 必需 String 用于计算百分位数的数值字段。 values 必需 Array of doubles 用于计算百分位数的值。 keyed 可选 Boolean 如果设置为 false ，则将结果作为数组返回。否则将结果作为 JSON 对象返回。默认值为 true 。 tdigest.compression 可选 Double 控制 tdigest 算法的准确性和内存使用。参见使用 tdigest 进行精度调整。 hdr.number_of_significant_value_digits 可选 Integer HDR 直方图的精度设置。参见 HDR 直方图。 missing 可选 Numeric 当文档中目标字段缺失时使用的默认值。 script 可选 Object 用于计算自定义值而不是使用字段的脚本。支持内联和存储脚本。 参考样例 # 首先，创建一个示例索引：</description></item><item><title>百分位聚合</title><link>/easysearch/main/docs/references/aggregation/metric-aggregations/percentile/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/references/aggregation/metric-aggregations/percentile/</guid><description>百分位聚合 # percentiles 百分位聚合估计数值字段在给定百分位处的值。这对于理解分布边界很有用。
例如， load_time 的 95th 百分位 = 120ms 表示 95% 的值小于或等于 120 毫秒。
与 cardinality 指标类似， percentile 指标也是近似的。
参数说明 # percentiles 聚合采用以下参数。
参数 必需/可选 数据类型 描述 field 必需 String 用于计算百分位数的数值字段。 percents 可选 Array of doubles 返回百分位数列表。默认为 [1, 5, 25, 50, 75, 95, 99] 。 keyed 可选 Boolean 如果设置为 false ，则将结果作为数组返回。否则将结果作为 JSON 对象返回。默认值为 true 。 tdigest.</description></item><item><title>矩阵统计聚合</title><link>/easysearch/main/docs/references/aggregation/metric-aggregations/matrix-stats/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/references/aggregation/metric-aggregations/matrix-stats/</guid><description>矩阵统计聚合 # matrix_stats 矩阵统计聚合是一个多值指标聚合，以矩阵形式为两个或多个字段生成协方差统计。
matrix_stats 聚合不支持脚本。
参数说明 # matrix_stats 聚合采用以下参数。
参数 必需/可选 数据类型 描述 field 必需 String 用于计算矩阵统计的一组字段。 missing 可选 Object 用于替代缺失值的值。默认情况下，会忽略缺失值。参见缺失值。 mode 可选 String 用作多值或数组字段样本的值。允许的值是 avg 、 min 、 max 、 sum 和 median 。默认是 avg 。 参考样例 # 以下示例返回数据中 taxful_total_price 和 products.base_price 字段的统计信息：
GET sample_data_ecommerce/_search { &amp;quot;size&amp;quot;: 0, &amp;quot;aggs&amp;quot;: { &amp;quot;matrix_stats_taxful_total_price&amp;quot;: { &amp;quot;matrix_stats&amp;quot;: { &amp;quot;fields&amp;quot;: [&amp;quot;taxful_total_price&amp;quot;, &amp;quot;products.</description></item><item><title>统计聚合</title><link>/easysearch/main/docs/references/aggregation/metric-aggregations/stats/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/references/aggregation/metric-aggregations/stats/</guid><description>统计聚合 # stats 聚合是一个多值指标聚合，用于计算数值数据的汇总。这种聚合有助于快速了解数值字段的分布情况。它可以直接作用于字段，应用脚本来派生值，或处理缺少字段的文档。 stats 聚合返回五个值：
count : 收集到的值的数量 min : 最低值 max : 最高值 sum : 所有值的总和 avg : 值的平均数（总和除以数量） 参数说明 # stats 聚合支持以下可选参数。
参数 必需/可选 数据类型 描述 field 必需 String 要聚合的字段。必须是数值字段。 script 可选 Object 用于计算聚合自定义值的脚本。可单独使用或与 field 一起使用。 missing 可选 Number 用于缺少目标字段的文档的默认值。 参考样例 # 以下示例计算 stats 聚合的电力使用情况。
创建一个名为 power_usage 的索引，并添加包含给定小时内消耗的千瓦时 (kWh) 数量的文档：</description></item><item><title>脚本指标聚合</title><link>/easysearch/main/docs/references/aggregation/metric-aggregations/scripted-metric/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/easysearch/main/docs/references/aggregation/metric-aggregations/scripted-metric/</guid><description>脚本指标聚合 # scripted_metric 脚本指标聚合是一个多值指标聚合，它返回根据指定脚本计算的指标。脚本有四个阶段， init 、 map 、 combine 和 reduce ，每个聚合按顺序运行这些阶段，组合来自文档的结果。
所有四个脚本共享一个可变对象，称为 state ，该对象由你定义。 state 在 init 、 map 和 combine 阶段时对每个分片是局部的。结果被传递到 states 数组中用于 reduce 阶段。因此，每个分片的 state 在分片在 reduce 步骤中组合之前是独立的。
参数说明 # scripted_metric 聚合采用以下参数。
参数 必需/可选 数据类型 描述 init_script 可选 String 一个脚本，在每个分片上处理任何文档之前执行一次。用于设置初始 state （例如，在 state 对象中初始化计数器或列表）。如果没有提供， state 在每个分片上开始时是一个空对象。 map_script 必需 String 一个脚本，针对聚合收集的每个文档执行。此脚本根据文档的数据更新 state 。例如，您可以检查字段的值，然后递增计数器或在 state 中计算运行总和。 combine_script 必需 String 一个脚本，在每个分片上处理完所有文档后由 map_script 执行一次。此脚本将分片的 state 聚合为单个结果发送回协调节点。此脚本用于完成一个分片的计算（例如，汇总存储在 state 中的计数器或总计）。脚本应返回其分片的汇总值或结构。 reduce_script 必需 String 一个脚本在接收到所有分片的合并结果后，在协调节点上执行一次。这个脚本接收一个特殊变量 states ，它是一个包含每个分片从 combine_script 输出的数组。 reduce_script 遍历状态并生成最终的聚合输出（例如，添加分片总和或合并计数的映射）。 reduce_script 返回的值是在聚合结果中报告的值。 params 可选 Object 除 reduce_script 外，所有脚本都可以访问用户定义的参数。 可返回的类型 # 脚本可以在内部使用任何有效的操作和对象。然而，存储在 state 或从任何脚本返回的数据必须属于允许的类型之一。这个限制存在是因为中间 state 需要在节点之间发送。允许的类型如下：</description></item></channel></rss>