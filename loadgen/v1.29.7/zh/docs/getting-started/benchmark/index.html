<!doctype html><html lang=zh><head><meta name=generator content="Hugo 0.79.1"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="性能测试 #  INFINI Loadgen 是一款专为 Easysearch、Elasticsearch、OpenSearch 设计的轻量级性能测试工具。
Loadgen 的特点：
 性能强劲 轻量级无依赖 支持模板化参数随机 支持高并发 支持压测端均衡流量控制 支持服务端返回值校验   下载地址：https://release.infinilabs.com/loadgen/
 Loadgen #  Loadgen 使用非常简单，下载解压之后会得到三个文件，一个可执行程序、一个配置文件 loadgen.yml 以及用于运行测试的 loadgen.dsl，配置文件样例如下：
env: ES_USERNAME: elastic ES_PASSWORD: elastic ES_ENDPOINT: http://localhost:8000 测试文件样例如下：
# runner: { # // total_rounds: 1 # no_warm: false, # // Whether to log all requests # log_requests: false, # // Whether to log all requests with the specified response status # log_status_codes: [0, 500], # assert_invalid: false, # assert_error: false, # }, # variables: [ # { # name: &#34;ip&#34;, # type: &#34;file&#34;, # path: &#34;dict/ip."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="性能测试"><meta property="og:description" content="性能测试 #  INFINI Loadgen 是一款专为 Easysearch、Elasticsearch、OpenSearch 设计的轻量级性能测试工具。
Loadgen 的特点：
 性能强劲 轻量级无依赖 支持模板化参数随机 支持高并发 支持压测端均衡流量控制 支持服务端返回值校验   下载地址：https://release.infinilabs.com/loadgen/
 Loadgen #  Loadgen 使用非常简单，下载解压之后会得到三个文件，一个可执行程序、一个配置文件 loadgen.yml 以及用于运行测试的 loadgen.dsl，配置文件样例如下：
env: ES_USERNAME: elastic ES_PASSWORD: elastic ES_ENDPOINT: http://localhost:8000 测试文件样例如下：
# runner: { # // total_rounds: 1 # no_warm: false, # // Whether to log all requests # log_requests: false, # // Whether to log all requests with the specified response status # log_status_codes: [0, 500], # assert_invalid: false, # assert_error: false, # }, # variables: [ # { # name: &#34;ip&#34;, # type: &#34;file&#34;, # path: &#34;dict/ip."><meta property="og:type" content="article"><meta property="og:url" content="/loadgen/v1.29.7/zh/docs/getting-started/benchmark/"><title>性能测试 | INFINI Loadgen</title><link rel=manifest href=/loadgen/v1.29.7/manifest.json><link rel=icon href=/loadgen/v1.29.7/favicon.png type=image/x-icon><link rel=alternate hreflang=en href=/loadgen/v1.29.7/docs/getting-started/benchmark/ title="Benchmark Testing"><link rel=stylesheet href=/loadgen/v1.29.7/book.min.d80e87b12a4b49d9913d0bdd98bd83b7a44988be784760ba15522b377313dcf9.css integrity="sha256-2A6HsSpLSdmRPQvdmL2Dt6RJiL54R2C6FVIrN3MT3Pk="><script defer src=/loadgen/v1.29.7/js/jquery-2.x.min.js></script><script defer src=/loadgen/v1.29.7/js/doc.js></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/loadgen/v1.29.7/zh><img src=/loadgen/v1.29.7/img/logo-zh.svg alt=Logo></a></h2><div id=searchbox style=margin-bottom:10px;outline:none></div><div class=heading><select class=version-selector>
<option value>main (latest)</option>
<option value=v1.29.7>v1.29.7</option>
<option value=v1.29.6>v1.29.6</option>
<option value=v1.29.4>v1.29.4</option>
<option value=v1.29.3>v1.29.3</option>
<option value=v1.29.2>v1.29.2</option>
<option value=v1.29.1>v1.29.1</option>
<option value=v1.29.0>v1.29.0</option>
<option value=v1.28.2>v1.28.2</option>
<option value=v1.28.0>v1.28.0</option>
<option value=v1.27.0>v1.27.0</option></select></div><ul><li><input type=checkbox id=section-f1b7c1b2e5dd43526e77637c475d35b8 class=toggle checked>
<label for=section-f1b7c1b2e5dd43526e77637c475d35b8 class="flex justify-between"><a>入门指南</a>
<span>▾</span></label><ul><li><a href=/loadgen/v1.29.7/zh/docs/getting-started/install/>下载安装</a></li><li><a href=/loadgen/v1.29.7/zh/docs/getting-started/benchmark/ class=active>性能测试</a></li></ul></li><li><a href=/loadgen/v1.29.7/zh/docs/release-notes/>版本历史</a><ul></ul></li><li><a href=/loadgen/v1.29.7/zh/docs/resources/>其它资源</a><ul></ul></li></ul><ul><li><a href=https://github.com/infinilabs/loadgen target=_blank rel=noopener>Github</a></li></ul><div class=book-languages tabindex=0 aria-haspopup=true><ul><li class="flex align-center"><img src=/loadgen/v1.29.7/svg/translate.svg class=book-icon alt=Languages>
简体中文</li></ul><ul class=book-languages-list><li><a href=/loadgen/v1.29.7/docs/getting-started/benchmark/ class="flex align-center"><img src=/loadgen/v1.29.7/svg/translate.svg class=book-icon alt=Languages>
English</a></li><li class=active><a href=/loadgen/v1.29.7/zh/ class="flex align-center"><img src=/loadgen/v1.29.7/svg/translate.svg class=book-icon alt=Languages>
简体中文</a></li></ul></div></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/loadgen/v1.29.7/svg/menu.svg class=book-icon alt=Menu></label>
<strong>性能测试</strong>
<label for=toc-control><img src=/loadgen/v1.29.7/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#性能测试>性能测试</a><ul><li><a href=#loadgen>Loadgen</a><ul><li><a href=#运行模式设置>运行模式设置</a></li><li><a href=#http-响应头处理>HTTP 响应头处理</a></li></ul></li><li><a href=#变量的使用>变量的使用</a><ul><li><a href=#变量使用示例>变量使用示例</a></li><li><a href=#环境变量>环境变量</a></li></ul></li><li><a href=#请求的定义>请求的定义</a><ul><li><a href=#模拟批量写入>模拟批量写入</a></li><li><a href=#返回值判断>返回值判断</a></li><li><a href=#动态变量注册>动态变量注册</a></li></ul></li><li><a href=#执行压测>执行压测</a><ul><li><a href=#命令行参数>命令行参数</a></li><li><a href=#限制客户端压力>限制客户端压力</a></li><li><a href=#限制请求的总条数>限制请求的总条数</a></li><li><a href=#使用自增-id-来确保文档的顺序性>使用自增 ID 来确保文档的顺序性</a></li><li><a href=#上下文复用变量>上下文复用变量</a></li><li><a href=#自定义-header>自定义 Header</a></li></ul></li><li><a href=#运行测试套件>运行测试套件</a><ul><li><a href=#环境变量配置>环境变量配置</a></li><li><a href=#测试用例配置>测试用例配置</a></li><li><a href=#测试套件运行>测试套件运行</a></li></ul></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=性能测试>性能测试
<a class=anchor href=#%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95>#</a></h1><p>INFINI Loadgen 是一款专为 Easysearch、Elasticsearch、OpenSearch 设计的轻量级性能测试工具。</p><p>Loadgen 的特点：</p><ul><li>性能强劲</li><li>轻量级无依赖</li><li>支持模板化参数随机</li><li>支持高并发</li><li>支持压测端均衡流量控制</li><li>支持服务端返回值校验</li></ul><blockquote><p>下载地址：<a href=https://release.infinilabs.com/loadgen/>https://release.infinilabs.com/loadgen/</a></p></blockquote><h2 id=loadgen>Loadgen
<a class=anchor href=#loadgen>#</a></h2><p>Loadgen 使用非常简单，下载解压之后会得到三个文件，一个可执行程序、一个配置文件 <code>loadgen.yml</code> 以及用于运行测试的 <code>loadgen.dsl</code>，配置文件样例如下：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>env</span>:
  <span style=color:#f92672>ES_USERNAME</span>: <span style=color:#ae81ff>elastic</span>
  <span style=color:#f92672>ES_PASSWORD</span>: <span style=color:#ae81ff>elastic</span>
  <span style=color:#f92672>ES_ENDPOINT</span>: <span style=color:#ae81ff>http://localhost:8000</span>
</code></pre></div><p>测试文件样例如下：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text># runner: {
#   // total_rounds: 1
#   no_warm: false,
#   // Whether to log all requests
#   log_requests: false,
#   // Whether to log all requests with the specified response status
#   log_status_codes: [0, 500],
#   assert_invalid: false,
#   assert_error: false,
# },
# variables: [
#   {
#     name: &#34;ip&#34;,
#     type: &#34;file&#34;,
#     path: &#34;dict/ip.txt&#34;,
#     // Replace special characters in the value
#     replace: {
#       &#39;&#34;&#39;: &#39;\\&#34;&#39;,
#       &#39;\\&#39;: &#39;\\\\&#39;,
#     },
#   },
#   {
#     name: &#34;id&#34;,
#     type: &#34;sequence&#34;,
#   },
#   {
#     name: &#34;id64&#34;,
#     type: &#34;sequence64&#34;,
#   },
#   {
#     name: &#34;uuid&#34;,
#     type: &#34;uuid&#34;,
#   },
#   {
#     name: &#34;now_local&#34;,
#     type: &#34;now_local&#34;,
#   },
#   {
#     name: &#34;now_utc&#34;,
#     type: &#34;now_utc&#34;,
#   },
#   {
#     name: &#34;now_utc_lite&#34;,
#     type: &#34;now_utc_lite&#34;,
#   },
#   {
#     name: &#34;now_unix&#34;,
#     type: &#34;now_unix&#34;,
#   },
#   {
#     name: &#34;now_with_format&#34;,
#     type: &#34;now_with_format&#34;,
#     // https://programming.guide/go/format-parse-string-time-date-example.html
#     format: &#34;2006-01-02T15:04:05-0700&#34;,
#   },
#   {
#     name: &#34;suffix&#34;,
#     type: &#34;range&#34;,
#     from: 10,
#     to: 1000,
#   },
#   {
#     name: &#34;bool&#34;,
#     type: &#34;range&#34;,
#     from: 0,
#     to: 1,
#   },
#   {
#     name: &#34;list&#34;,
#     type: &#34;list&#34;,
#     data: [&#34;medcl&#34;, &#34;abc&#34;, &#34;efg&#34;, &#34;xyz&#34;],
#   },
#   {
#     name: &#34;id_list&#34;,
#     type: &#34;random_array&#34;,
#     variable_type: &#34;number&#34;, // number/string
#     variable_key: &#34;suffix&#34;, // variable key to get array items
#     square_bracket: false,
#     size: 10, // how many items for array
#   },
#   {
#     name: &#34;str_list&#34;,
#     type: &#34;random_array&#34;,
#     variable_type: &#34;number&#34;, // number/string
#     variable_key: &#34;suffix&#34;, // variable key to get array items
#     square_bracket: true,
#     size: 10, // how many items for array
#     replace: {
#       // Use &#39; instead of &#34; for string quotes
#       &#39;&#34;&#39;: &#34;&#39;&#34;,
#       // Use {} instead of [] as array brackets
#       &#34;[&#34;: &#34;{&#34;,
#       &#34;]&#34;: &#34;}&#34;,
#     },
#   },
# ],

POST $[[env.ES_ENDPOINT]]/medcl/_search
{ &#34;track_total_hits&#34;: true, &#34;size&#34;: 0, &#34;query&#34;: { &#34;terms&#34;: { &#34;patent_id&#34;: [ $[[id_list]] ] } } }
# request: {
#   runtime_variables: {batch_no: &#34;uuid&#34;},
#   runtime_body_line_variables: {routing_no: &#34;uuid&#34;},
#   basic_auth: {
#     username: &#34;$[[env.ES_USERNAME]]&#34;,
#     password: &#34;$[[env.ES_PASSWORD]]&#34;,
#   },
# },
</code></pre></div><h3 id=运行模式设置>运行模式设置
<a class=anchor href=#%e8%bf%90%e8%a1%8c%e6%a8%a1%e5%bc%8f%e8%ae%be%e7%bd%ae>#</a></h3><p>默认配置下，Loadgen 会以性能测试模式运行，在指定时间（<code>-d</code>）内重复执行 <code>requests</code> 里的所有请求。如果只需要检查一次测试结果，可以通过 <code>runner.total_rounds</code> 来设置 <code>requests</code> 的执行次数。</p><h3 id=http-响应头处理>HTTP 响应头处理
<a class=anchor href=#http-%e5%93%8d%e5%ba%94%e5%a4%b4%e5%a4%84%e7%90%86>#</a></h3><p>默认配置下，Loadgen 会自动格式化 HTTP 的响应头（<code>user-agent: xxx</code> -> <code>User-Agent: xxx</code>），如果需要精确判断服务器返回的响应头，可以通过 <code>runner.disable_header_names_normalizing</code> 来禁用这个行为。</p><h2 id=变量的使用>变量的使用
<a class=anchor href=#%e5%8f%98%e9%87%8f%e7%9a%84%e4%bd%bf%e7%94%a8>#</a></h2><p>上面的配置中，<code>variables</code> 用来定义变量参数，根据 <code>name</code> 来设置变量标识，在构造请求的使用 <code>$[[变量名]]</code> 即可访问该变量的值，变量目前支持的类型有：</p><table><thead><tr><th>类型</th><th>说明</th><th>变量参数</th></tr></thead><tbody><tr><td><code>file</code></td><td>文件型外部变量参数</td><td><code>path</code>: 数据文件路径<br><code>data</code>: 数据列表，会被附加到<code>path</code>文件内容后读取</td></tr><tr><td><code>list</code></td><td>自定义枚举变量参数</td><td><code>data</code>: 字符数组类型的枚举数据列表</td></tr><tr><td><code>sequence</code></td><td>32 位自增数字类型的变量</td><td><code>from</code>: 初始值<br><code>to</code>: 最大值</td></tr><tr><td><code>sequence64</code></td><td>64 位自增数字类型的变量</td><td><code>from</code>: 初始值<br><code>to</code>: 最大值</td></tr><tr><td><code>range</code></td><td>数字范围类型的变量，支持参数 <code>from</code> 和 <code>to</code> 来限制范围</td><td><code>from</code>: 初始值<br><code>to</code>: 最大值</td></tr><tr><td><code>random_array</code></td><td>生成一个随机数组，数据元素来自<code>variable_key</code>指定的变量</td><td><code>variable_key</code>: 数据源变量<br><code>size</code>: 输出数组的长度<br><code>square_bracket</code>: <code>true/false</code>，输出值是否需要<code>[</code>和<code>]</code><br><code>string_bracket</code>: 字符串，输出元素前后会附加指定的字符串</td></tr><tr><td><code>uuid</code></td><td>UUID 字符类型的变量</td><td></td></tr><tr><td><code>now_local</code></td><td>当前时间、本地时区</td><td></td></tr><tr><td><code>now_utc</code></td><td>当前时间、UTC 时区。输出格式:<code>2006-01-02 15:04:05.999999999 -0700 MST</code></td><td></td></tr><tr><td><code>now_utc_lite</code></td><td>当前时间、UTC 时区。输出格式:<code>2006-01-02T15:04:05.000</code></td><td></td></tr><tr><td><code>now_unix</code></td><td>当前时间、Unix 时间戳</td><td></td></tr><tr><td><code>now_with_format</code></td><td>当前时间，支持自定义 <code>format</code> 参数来格式化时间字符串，如：<code>2006-01-02T15:04:05-0700</code></td><td><code>format</code>: 输出的时间格式 (
<a href=https://www.geeksforgeeks.org/time-formatting-in-golang/>示例</a>)</td></tr></tbody></table><h3 id=变量使用示例>变量使用示例
<a class=anchor href=#%e5%8f%98%e9%87%8f%e4%bd%bf%e7%94%a8%e7%a4%ba%e4%be%8b>#</a></h3><p><code>file</code> 类型变量参数加载自外部文本文件，每行一个变量参数，访问该变量时每次随机取其中一个，变量里面的定义格式举例如下：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text># test/user.txt
medcl
elastic
</code></pre></div><p>附生成固定长度的随机字符串，如 1024 个字符每行：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>LC_CTYPE<span style=color:#f92672>=</span>C tr -dc A-Za-z0-9_<span style=color:#ae81ff>\!\@\#\$\%\^\&amp;\*\(\)</span>-+<span style=color:#f92672>=</span> &lt; /dev/random | head -c <span style=color:#ae81ff>1024</span> &gt;&gt; 1k.txt
</code></pre></div><h3 id=环境变量>环境变量
<a class=anchor href=#%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f>#</a></h3><p>Loadgen 支持自动读取环境变量，环境变量可以在运行 Loadgen 时通过命令行传入，也可以在 <code>loadgen.dsl</code> 里指定默认的环境变量值，Loadgen 运行时会使用命令行传入的环境变量覆盖 <code>loadgen.dsl</code> 里的默认值。</p><p>配置的环境变量可以通过 <code>$[[env.环境变量]]</code> 来使用：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>#// 配置环境变量默认值
# env: {
#   ES_USERNAME: &#34;elastic&#34;,
#   ES_PASSWORD: &#34;elastic&#34;,
#   ES_ENDPOINT: &#34;http://localhost:8000&#34;,
# },

#// 使用运行时变量
GET $[[env.ES_ENDPOINT]]/medcl/_search
{&#34;query&#34;: {&#34;match&#34;: {&#34;name&#34;: &#34;$[[user]]&#34;}}}
# request: {
#   // 使用运行时变量
#   basic_auth: {
#     username: &#34;$[[env.ES_USERNAME]]&#34;,
#     password: &#34;$[[env.ES_PASSWORD]]&#34;,
#   },
# },
</code></pre></div><h2 id=请求的定义>请求的定义
<a class=anchor href=#%e8%af%b7%e6%b1%82%e7%9a%84%e5%ae%9a%e4%b9%89>#</a></h2><p>配置节点 <code>requests</code> 用来设置 Loadgen 将依次执行的请求，支持固定参数的请求，也可支持模板变量参数化构造请求，以下是一个普通的查询请求：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>GET http://localhost:8000/medcl/_search?q=name:$[[user]]
# request: {
#   username: elastic,
#   password: pass,
# },
</code></pre></div><p>上面的查询对 <code>medcl</code> 索引进行了查询，并对 <code>name</code> 字段执行一个查询，每次请求的值来自随机变量 <code>user</code>。</p><h3 id=模拟批量写入>模拟批量写入
<a class=anchor href=#%e6%a8%a1%e6%8b%9f%e6%89%b9%e9%87%8f%e5%86%99%e5%85%a5>#</a></h3><p>使用 Loadgen 来模拟 bulk 批量写入也非常简单，在请求体里面配置一条索引操作，然后使用 <code>body_repeat_times</code> 参数来随机参数化复制若干条请求即可完成一批请求的准备，如下：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>POST http://localhost:8000/_bulk
{&#34;index&#34;: {&#34;_index&#34;: &#34;medcl-y4&#34;, &#34;_type&#34;: &#34;doc&#34;, &#34;_id&#34;: &#34;$[[uuid]]&#34;}}
{&#34;id&#34;: &#34;$[[id]]&#34;, &#34;field1&#34;: &#34;$[[user]]&#34;, &#34;ip&#34;: &#34;$[[ip]]&#34;, &#34;now_local&#34;: &#34;$[[now_local]]&#34;, &#34;now_unix&#34;: &#34;$[[now_unix]]&#34;}
# request: {
#   basic_auth: {
#     username: &#34;test&#34;,
#     password: &#34;testtest&#34;,
#  },
#  body_repeat_times: 1000,
# },
</code></pre></div><h3 id=返回值判断>返回值判断
<a class=anchor href=#%e8%bf%94%e5%9b%9e%e5%80%bc%e5%88%a4%e6%96%ad>#</a></h3><p>每个 <code>requests</code> 配置可以通过 <code>assert</code> 来设置是否需要检查返回值。<code>assert</code> 功能支持 INFINI Gateway 的大部分
<a href=https://infinilabs.cn/docs/latest/gateway/references/flow/#%e6%9d%a1%e4%bb%b6%e7%b1%bb%e5%9e%8b>条件判断功能</a>。</p><blockquote><p>请阅读
<a href=https://infinilabs.cn/blog/2023/simplify-loadgen-config-with-dsl/>《借助 DSL 来简化 Loadgen 配置》</a>来了解更多细节。</p></blockquote><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>GET http://localhost:8000/medcl/_search?q=name:$[[user]]
# request: {
#   basic_auth: {
#     username: &#34;test&#34;,
#     password: &#34;testtest&#34;,
#  },
# },
# assert: {
#   _ctx.response.status: 201,
# },
</code></pre></div><p>请求返回值可以通过 <code>_ctx</code> 获取，<code>_ctx</code> 目前包含以下信息：</p><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>_ctx.response.status</code></td><td>HTTP 返回状态码</td></tr><tr><td><code>_ctx.response.header</code></td><td>HTTP 返回响应头</td></tr><tr><td><code>_ctx.response.body</code></td><td>HTTP 返回响应体</td></tr><tr><td><code>_ctx.response.body_json</code></td><td>如果 HTTP 返回响应体是一个有效的 JSON 字符串，可以通过 <code>body_json</code> 来访问 JSON 内容字段</td></tr><tr><td><code>_ctx.elapsed</code></td><td>当前请求发送到返回消耗的时间（毫秒）</td></tr></tbody></table><p>如果请求失败（请求地址无法访问等），Loadgen 无法获取 HTTP 请求返回值，Loadgen 会在输出日志里记录 <code>Number of Errors</code>。如果配置了 <code>runner.assert_error</code> 且存在请求失败的请求，Loadgen 会返回 <code>exit(2)</code> 错误码。</p><p>如果返回值不符合判断条件，Loadgen 会停止执行当前轮次后续请求，并在输出日志里记录 <code>Number of Invalid</code>。如果配置了 <code>runner.assert_invalid</code> 且存在判断失败的请求，Loadgen 会返回 <code>exit(1)</code> 错误码。</p><h3 id=动态变量注册>动态变量注册
<a class=anchor href=#%e5%8a%a8%e6%80%81%e5%8f%98%e9%87%8f%e6%b3%a8%e5%86%8c>#</a></h3><p>每个 <code>requests</code> 配置可以通过 <code>register</code> 来动态添加运行时参数，一个常见的使用场景是根据前序请求的返回值来动态设置后序请求的参数。</p><p>这个示例调用 <code>$[[env.ES_ENDPOINT]]/test</code> 接口获取索引的 UUID，并注册到 <code>index_id</code> 变量。后续的请求定义可以通过 <code>$[[index_id]]</code> 来获取这个值。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>GET $[[env.ES_ENDPOINT]]/test
# register: [
#   {index_id: &#34;_ctx.response.body_json.test.settings.index.uuid&#34;},
# ],
# assert: (200, {}),
</code></pre></div><h2 id=执行压测>执行压测
<a class=anchor href=#%e6%89%a7%e8%a1%8c%e5%8e%8b%e6%b5%8b>#</a></h2><p>执行 Loadgen 程序即可执行压测，如下:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ loadgen -d 30 -c 100 -compress -run loadgen.dsl
   __   ___  _      ___  ___   __    __
  / /  /___\/_\    /   \/ _ \ /__\/\ \ \
 / /  //  ///_\\  / /\ / /_\//_\ /  \/ /
/ /__/ \_//  _  \/ /_// /_\\//__/ /\  /
\____|___/\_/ \_/___,&#39;\____/\__/\_\ \/

[LOADGEN] A http load generator and testing suit.
[LOADGEN] 1.0.0_SNAPSHOT, 83f2cb9, Sun Jul 4 13:52:42 2021 +0800, medcl, support single item in dict files
[07-19 16:15:00] [INF] [instance.go:24] workspace: data/loadgen/nodes/0
[07-19 16:15:00] [INF] [loader.go:312] warmup started
[07-19 16:15:00] [INF] [app.go:306] loadgen now started.
[07-19 16:15:00] [INF] [loader.go:316] [GET] http://localhost:8000/medcl/_search
[07-19 16:15:00] [INF] [loader.go:317] status: 200,&lt;nil&gt;,{&#34;took&#34;:1,&#34;timed_out&#34;:false,&#34;_shards&#34;:{&#34;total&#34;:1,&#34;successful&#34;:1,&#34;skipped&#34;:0,&#34;failed&#34;:0},&#34;hits&#34;:{&#34;total&#34;:{&#34;value&#34;:0,&#34;relation&#34;:&#34;eq&#34;},&#34;max_score&#34;:null,&#34;hits&#34;:[]}}
[07-19 16:15:00] [INF] [loader.go:316] [GET] http://localhost:8000/medcl/_search?q=name:medcl
[07-19 16:15:00] [INF] [loader.go:317] status: 200,&lt;nil&gt;,{&#34;took&#34;:1,&#34;timed_out&#34;:false,&#34;_shards&#34;:{&#34;total&#34;:1,&#34;successful&#34;:1,&#34;skipped&#34;:0,&#34;failed&#34;:0},&#34;hits&#34;:{&#34;total&#34;:{&#34;value&#34;:0,&#34;relation&#34;:&#34;eq&#34;},&#34;max_score&#34;:null,&#34;hits&#34;:[]}}
[07-19 16:15:01] [INF] [loader.go:316] [POST] http://localhost:8000/_bulk
[07-19 16:15:01] [INF] [loader.go:317] status: 200,&lt;nil&gt;,{&#34;took&#34;:120,&#34;errors&#34;:false,&#34;items&#34;:[{&#34;index&#34;:{&#34;_index&#34;:&#34;medcl-y4&#34;,&#34;_type&#34;:&#34;doc&#34;,&#34;_id&#34;:&#34;c3qj9123r0okahraiej0&#34;,&#34;_version&#34;:1,&#34;result&#34;:&#34;created&#34;,&#34;_shards&#34;:{&#34;total&#34;:2,&#34;successful&#34;:1,&#34;failed&#34;:0},&#34;_seq_no&#34;:5735852,&#34;_primary_term&#34;:3,&#34;status&#34;:201}}]}
[07-19 16:15:01] [INF] [loader.go:325] warmup finished

5253 requests in 32.756483336s, 524.61KB sent, 2.49MB received

[Loadgen Client Metrics]
Requests/sec:		175.10
Request Traffic/sec:	17.49KB
Total Transfer/sec:	102.34KB
Avg Req Time:		5.711022ms
Fastest Request:	440.448µs
Slowest Request:	3.624302658s
Number of Errors:	0
Number of Invalid:	0
Status 200:		5253

[Estimated Server Metrics]
Requests/sec:		160.37
Transfer/sec:		93.73KB
Avg Req Time:		623.576686ms
</code></pre></div><p>Loadgen 在正式压测之前会将所有的请求执行一次来进行预热，如果出现错误会提示是否继续，预热的请求结果也会输出到终端，执行完成之后会输出执行的摘要信息。可以通过设置 <code>runner.no_warm</code> 来跳过这个检查阶段。</p><blockquote><p>因为 Loadgen 最后的结果是所有请求全部执行完成之后的累计统计，可能存在不准的问题，建议通过打开 Kibana 的监控仪表板来实时查看 Elasticsearch 的各项运行指标。</p></blockquote><h3 id=命令行参数>命令行参数
<a class=anchor href=#%e5%91%bd%e4%bb%a4%e8%a1%8c%e5%8f%82%e6%95%b0>#</a></h3><p>Loadgen 会循环执行配置文件里面定义的请求，默认 Loadgen 只会运行 <code>5s</code> 就自动退出了，如果希望延长运行时间或者加大并发可以通过启动的时候设置参数来控制，通过查看帮助命令如下：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ loadgen -help
Usage of loadgen:
  -c int
    	Number of concurrent threads (default 1)
  -compress
    	Compress requests with gzip
  -config string
    	the location of config file (default &#34;loadgen.yml&#34;)
  -cpu int
    	the number of CPUs to use (default -1)
  -d int
    	Duration of tests in seconds (default 5)
  -debug
    	run in debug mode, loadgen will quit on panic immediately with full stack trace
  -dial-timeout int
    	Connection dial timeout in seconds, default 3s (default 3)
  -gateway-log string
    	Log level of Gateway (default &#34;debug&#34;)
  -l int
    	Limit total requests (default -1)
  -log string
    	the log level, options: trace,debug,info,warn,error,off
  -mem int
    	the max size of Memory to use, soft limit in megabyte (default -1)
  -plugin value
    	load additional plugins
  -r int
    	Max requests per second (fixed QPS) (default -1)
  -read-timeout int
    	Connection read timeout in seconds, default 0s (use -timeout)
  -run string
    	DSL config to run tests (default &#34;loadgen.dsl&#34;)
  -service string
    	service management, options: install,uninstall,start,stop
  -timeout int
    	Request timeout in seconds, default 60s (default 60)
  -v	version
  -write-timeout int
    	Connection write timeout in seconds, default 0s (use -timeout)
</code></pre></div><h3 id=限制客户端压力>限制客户端压力
<a class=anchor href=#%e9%99%90%e5%88%b6%e5%ae%a2%e6%88%b7%e7%ab%af%e5%8e%8b%e5%8a%9b>#</a></h3><p>使用 Loadgen 并设置命令行参数 <code>-r</code> 可以限制客户端发送的每秒请求数，从而评估固定压力下 Elasticsearch 的响应时间和负载情况，如下：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>loadgen -d <span style=color:#ae81ff>30</span> -c <span style=color:#ae81ff>100</span> -r <span style=color:#ae81ff>100</span>
</code></pre></div><blockquote><p>注意，在大量并发下，此客户端吞吐限制可能不完全准确。</p></blockquote><h3 id=限制请求的总条数>限制请求的总条数
<a class=anchor href=#%e9%99%90%e5%88%b6%e8%af%b7%e6%b1%82%e7%9a%84%e6%80%bb%e6%9d%a1%e6%95%b0>#</a></h3><p>通过设置参数 <code>-l</code> 可以控制客户端发送的请求总数，从而制造固定的文档，修改配置如下：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>#// loadgen-gw.dsl
POST http://localhost:8000/medcl-test/doc2/_bulk
{&#34;index&#34;: {&#34;_index&#34;: &#34;medcl-test&#34;, &#34;_id&#34;: &#34;$[[uuid]]&#34;}}
{&#34;id&#34;: &#34;$[[id]]&#34;, &#34;field1&#34;: &#34;$[[user]]&#34;, &#34;ip&#34;: &#34;$[[ip]]&#34;}
# request: {
#   basic_auth: {
#     username: &#34;test&#34;,
#     password: &#34;testtest&#34;,
#   },
#   body_repeat_times: 1,
# },
</code></pre></div><p>每次请求只有一个文档，然后执行 Loadgen</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>loadgen -run loadgen-gw.dsl -d <span style=color:#ae81ff>600</span> -c <span style=color:#ae81ff>100</span> -l <span style=color:#ae81ff>50000</span>
</code></pre></div><p>执行完成之后，Elasticsearch 的索引 <code>medcl-test</code> 将增加 <code>50000</code> 条记录。</p><h3 id=使用自增-id-来确保文档的顺序性>使用自增 ID 来确保文档的顺序性
<a class=anchor href=#%e4%bd%bf%e7%94%a8%e8%87%aa%e5%a2%9e-id-%e6%9d%a5%e7%a1%ae%e4%bf%9d%e6%96%87%e6%a1%a3%e7%9a%84%e9%a1%ba%e5%ba%8f%e6%80%a7>#</a></h3><p>如果希望生成的文档编号自增有规律，方便进行对比，可以使用 <code>sequence</code> 类型的自增 ID 来作为主键，内容也不要用随机数，如下：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>POST http://localhost:8000/medcl-test/doc2/_bulk
{&#34;index&#34;: {&#34;_index&#34;: &#34;medcl-test&#34;, &#34;_id&#34;: &#34;$[[id]]&#34;}}
{&#34;id&#34;: &#34;$[[id]]&#34;}
# request: {
#   basic_auth: {
#     username: &#34;test&#34;,
#     password: &#34;testtest&#34;,
#   },
#   body_repeat_times: 1,
# },
</code></pre></div><h3 id=上下文复用变量>上下文复用变量
<a class=anchor href=#%e4%b8%8a%e4%b8%8b%e6%96%87%e5%a4%8d%e7%94%a8%e5%8f%98%e9%87%8f>#</a></h3><p>在一个请求中，我们可能希望有相同的参数出现，比如 <code>routing</code> 参数用来控制分片的路由，同时我们又希望该参数也保存在文档的 JSON 里面，
可以使用 <code>runtime_variables</code> 来设置请求级别的变量，或者 <code>runtime_body_line_variables</code> 定义请求体级别的变量，如果请求体复制 N 份，每份的参数是不同的，举例如下：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text># variables: [
#   {name: &#34;id&#34;, type: &#34;sequence&#34;},
#   {name: &#34;uuid&#34;, type: &#34;uuid&#34;},
#   {name: &#34;now_local&#34;, type: &#34;now_local&#34;},
#   {name: &#34;now_utc&#34;, type: &#34;now_utc&#34;},
#   {name: &#34;now_unix&#34;, type: &#34;now_unix&#34;},
#   {name: &#34;suffix&#34;, type: &#34;range&#34;, from: 10, to 15},
# ],

POST http://192.168.3.188:9206/_bulk
{&#34;create&#34;: {&#34;_index&#34;: &#34;test-$[[suffix]]&#34;, &#34;_type&#34;: &#34;doc&#34;, &#34;_id&#34;: &#34;$[[uuid]]&#34;, &#34;routing&#34;: &#34;$[[routing_no]]&#34;}}
{&#34;id&#34;: &#34;$[[uuid]]&#34;, &#34;routing_no&#34;: &#34;$[[routing_no]]&#34;, &#34;batch_number&#34;: &#34;$[[batch_no]]&#34;, &#34;random_no&#34;: &#34;$[[suffix]]&#34;, &#34;ip&#34;: &#34;$[[ip]]&#34;, &#34;now_local&#34;: &#34;$[[now_local]]&#34;, &#34;now_unix&#34;: &#34;$[[now_unix]]&#34;}
# request: {
#   runtime_variables: {
#     batch_no: &#34;id&#34;,
#   },
#   runtime_body_line_variables: {
#     routing_no: &#34;uuid&#34;,
#   },
#   basic_auth: {
#     username: &#34;ingest&#34;,
#     password: &#34;password&#34;,
#   },
#   body_repeat_times: 10,
# },
</code></pre></div><p>我们定义了 <code>batch_no</code>　变量来代表一批文档里面的相同批次号，同时又定义了　<code>routing_no</code>　变量来代表每个文档级别的 routing 值。</p><h3 id=自定义-header>自定义 Header
<a class=anchor href=#%e8%87%aa%e5%ae%9a%e4%b9%89-header>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>GET http://localhost:8000/test/_search
# request: {
#   headers: [
#     {Agent: &#34;Loadgen-1&#34;},
#   ],
#   disable_header_names_normalizing: false,
# },
</code></pre></div><p>默认配置下，Loadgen 会自动格式化配置里的 HTTP 的请求头（<code>user-agent: xxx</code> -> <code>User-Agent: xxx</code>），如果需要精确设置 HTTP 请求头，可以通过设置 <code>disable_header_names_normalizing: true</code> 来禁用这个行为。</p><h2 id=运行测试套件>运行测试套件
<a class=anchor href=#%e8%bf%90%e8%a1%8c%e6%b5%8b%e8%af%95%e5%a5%97%e4%bb%b6>#</a></h2><p>Loadgen 支持批量运行测试用例，不需要重复编写测试用例，通过切换套件配置来快速测试不同的环境配置：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># loadgen.yml</span>
<span style=color:#f92672>env</span>:
  <span style=color:#75715e># Set up envrionments to run test suite</span>
  <span style=color:#f92672>LR_TEST_DIR</span>: <span style=color:#ae81ff>./testing</span> <span style=color:#75715e># The path to the test cases.</span>
  <span style=color:#75715e># If you want to start gateway dynamically and automatically:</span>
  <span style=color:#f92672>LR_GATEWAY_CMD</span>: <span style=color:#ae81ff>./bin/gateway</span> <span style=color:#75715e># The path to the executable of INFINI Gateway</span>
  <span style=color:#f92672>LR_GATEWAY_HOST</span>: <span style=color:#ae81ff>0.0.0.0</span>:<span style=color:#ae81ff>18000</span> <span style=color:#75715e># The binding host of the INFINI Gateway</span>
  <span style=color:#f92672>LR_GATEWAY_API_HOST</span>: <span style=color:#ae81ff>0.0.0.0</span>:<span style=color:#ae81ff>19000</span> <span style=color:#75715e># The binding host of the INFINI Gateway API server</span>
  <span style=color:#75715e># Set up other envrionments for the gateway and loadgen</span>
  <span style=color:#f92672>LR_ELASTICSEARCH_ENDPOINT</span>: <span style=color:#ae81ff>http://localhost:19201</span>
  <span style=color:#f92672>CUSTOM_ENV</span>: <span style=color:#ae81ff>myenv</span>
<span style=color:#f92672>tests</span>:
  <span style=color:#75715e># The relative path of test cases under `LR_TEST_DIR`</span>
  <span style=color:#75715e>#</span>
  <span style=color:#75715e># - gateway.yml: (Optional) the configuration to start the INFINI Gateway dynamically.</span>
  <span style=color:#75715e># - loadgen.dsl: the configuration to run the loadgen tool.</span>
  <span style=color:#75715e>#</span>
  <span style=color:#75715e># The environments set in `env` section will be passed to the INFINI Gateway and loadgen.</span>
  - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>cases/gateway/echo/echo_with_context</span>
</code></pre></div><h3 id=环境变量配置>环境变量配置
<a class=anchor href=#%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f%e9%85%8d%e7%bd%ae>#</a></h3><p>Loadgen 通过环境变量来动态配置 INFINI Gateway，环境变量在 <code>env</code> 里指定。以下环境变量是必选的：</p><table><thead><tr><th>变量名</th><th>说明</th></tr></thead><tbody><tr><td><code>LR_TEST_DIR</code></td><td>测试用例所在目录</td></tr></tbody></table><p>如果你需要 <code>loadgen</code> 根据配置动态启动 INFINI Gateway，需要设置以下环境变量：</p><table><thead><tr><th>变量名</th><th>说明</th></tr></thead><tbody><tr><td><code>LR_GATEWAY_CMD</code></td><td>INFINI Gateway 可执行文件的路径</td></tr><tr><td><code>LR_GATEWAY_HOST</code></td><td>INFINI Gateway 绑定的主机名:端口</td></tr><tr><td><code>LR_GATEWAY_API_HOST</code></td><td>INFINI Gateway API 绑定的主机名:端口</td></tr></tbody></table><h3 id=测试用例配置>测试用例配置
<a class=anchor href=#%e6%b5%8b%e8%af%95%e7%94%a8%e4%be%8b%e9%85%8d%e7%bd%ae>#</a></h3><p>测试用例在 <code>tests</code> 里配置，每个路径（<code>path</code>）指向一个测试用例的目录，每个测试用例需要配置一份 <code>gateway.yml</code>（可选）和 <code>loadgen.dsl</code>。配置文件可以使用 <code>env</code> 下配置的环境变量（<code>$[[env.ENV_KEY]]</code>）。</p><p><code>gateway.yml</code> 参考配置：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>path.data</span>: <span style=color:#ae81ff>data</span>
<span style=color:#f92672>path.logs</span>: <span style=color:#ae81ff>log</span>

<span style=color:#f92672>entry</span>:
  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my_es_entry</span>
    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
    <span style=color:#f92672>router</span>: <span style=color:#ae81ff>my_router</span>
    <span style=color:#f92672>max_concurrency</span>: <span style=color:#ae81ff>200000</span>
    <span style=color:#f92672>network</span>:
      <span style=color:#f92672>binding</span>: <span style=color:#ae81ff>$[[env.LR_GATEWAY_HOST]]</span>

<span style=color:#f92672>flow</span>:
  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>hello_world</span>
    <span style=color:#f92672>filter</span>:
      - <span style=color:#f92672>echo</span>:
          <span style=color:#f92672>message</span>: <span style=color:#e6db74>&#34;hello world&#34;</span>
<span style=color:#f92672>router</span>:
  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my_router</span>
    <span style=color:#f92672>default_flow</span>: <span style=color:#ae81ff>hello_world</span>
</code></pre></div><p><code>loadgen.dsl</code> 参考配置：</p><pre><code># runner: {
#   total_rounds: 1,
#   no_warm: true,
#   log_requests: true,
#   assert_invalid: true,
#   assert_error: true,
# },

GET http://$[[env.LR_GATEWAY_HOST]]/
# assert: {
#   _ctx.response: {
#     status: 200,
#     body: &quot;hello world&quot;,
#   },
# },
</code></pre><h3 id=测试套件运行>测试套件运行
<a class=anchor href=#%e6%b5%8b%e8%af%95%e5%a5%97%e4%bb%b6%e8%bf%90%e8%a1%8c>#</a></h3><p>配置好测试 <code>loadgen.yml</code> 后，可以通过以下命令运行 Loadgen：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>loadgen -config loadgen.yml
</code></pre></div><p>Loadgen 会运行配置指定的所有测试用例，并输出测试结果：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ loadgen -config loadgen.yml
   __   ___  _      ___  ___   __    __
  / /  /___\/_\    /   \/ _ \ /__\/\ \ \
 / /  //  ///_\\  / /\ / /_\//_\ /  \/ /
/ /__/ \_//  _  \/ /_// /_\\//__/ /\  /
\____|___/\_/ \_/___,&#39;\____/\__/\_\ \/

[LOADGEN] A http load generator and testing suit.
[LOADGEN] 1.0.0_SNAPSHOT, 83f2cb9, Sun Jul 4 13:52:42 2021 +0800, medcl, support single item in dict files
[02-21 10:50:05] [INF] [app.go:192] initializing loadgen
[02-21 10:50:05] [INF] [app.go:193] using config: /Users/kassian/Workspace/infini/src/infini.sh/testing/suites/dev.yml
[02-21 10:50:05] [INF] [instance.go:78] workspace: /Users/kassian/Workspace/infini/src/infini.sh/testing/data/loadgen/nodes/cfpihf15k34iqhpd4d00
[02-21 10:50:05] [INF] [app.go:399] loadgen is up and running now.
[2023-02-21 10:50:05][TEST][SUCCESS] [setup/loadgen/cases/dummy] duration: 105(ms)

1 requests in 68.373875ms, 0.00bytes sent, 0.00bytes received

[Loadgen Client Metrics]
Requests/sec:		0.20
Request Traffic/sec:	0.00bytes
Total Transfer/sec:	0.00bytes
Avg Req Time:		5s
Fastest Request:	68.373875ms
Slowest Request:	68.373875ms
Number of Errors:	0
Number of Invalid:	0
Status 200:		1

[Estimated Server Metrics]
Requests/sec:		14.63
Transfer/sec:		0.00bytes
Avg Req Time:		68.373875ms


[2023-02-21 10:50:06][TEST][FAILED] [setup/gateway/cases/echo/echo_with_context/] duration: 1274(ms)
#0 request, GET http://$[[env.LR_GATEWAY_HOST]]/any/, assertion failed, skiping subsequent requests
1 requests in 1.255678s, 0.00bytes sent, 0.00bytes received

[Loadgen Client Metrics]
Requests/sec:		0.20
Request Traffic/sec:	0.00bytes
Total Transfer/sec:	0.00bytes
Avg Req Time:		5s
Fastest Request:	1.255678s
Slowest Request:	1.255678s
Number of Errors:	1
Number of Invalid:	1
Status 0:		1

[Estimated Server Metrics]
Requests/sec:		0.80
Transfer/sec:		0.00bytes
Avg Req Time:		1.255678s

</code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div class=book-languages tabindex=0 aria-haspopup=true><ul><li class="flex align-center"><img src=/loadgen/v1.29.7/svg/translate.svg class=book-icon alt=Languages>
简体中文</li></ul><ul class=book-languages-list><li><a href=/loadgen/v1.29.7/docs/getting-started/benchmark/ class="flex align-center"><img src=/loadgen/v1.29.7/svg/translate.svg class=book-icon alt=Languages>
English</a></li><li class=active><a href=/loadgen/v1.29.7/zh/ class="flex align-center"><img src=/loadgen/v1.29.7/svg/translate.svg class=book-icon alt=Languages>
简体中文</a></li></ul></div><div><a class="flex align-center" href=https://github.com/infinilabs/loadgen/edit/v1.29.7/docs/content.zh/docs/getting-started/benchmark.md target=_blank rel=noopener><img src=/loadgen/v1.29.7/svg/edit.svg class=book-icon alt=Edit>
<span>编辑本页</span></a></div><div class="flex align-center footer">©INFINI.LTD, All Rights Reserved.</div><script async src="https://www.googletagmanager.com/gtag/js?id=G-RJPTVP614C"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-RJPTVP614C');</script><script type=text/javascript>var _smartsupp=_smartsupp||{};_smartsupp.key='691ff544d18a237005a011a7290b839d8fe811a4';window.smartsupp||(function(d){var s,c,o=smartsupp=function(){o._.push(arguments)};o._=[];s=d.getElementsByTagName('script')[0];c=d.createElement('script');c.type='text/javascript';c.charset='utf-8';c.async=true;c.src='https://www.smartsuppchat.com/loader.js?';s.parentNode.insertBefore(c,s);})(document);</script></div><script type=module>
    import { searchbox } from "https://coco.infini.cloud/integration/cvn0g9ehpcehvsthrakg/widget";
    searchbox({container: "#searchbox"});
</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#性能测试>性能测试</a><ul><li><a href=#loadgen>Loadgen</a><ul><li><a href=#运行模式设置>运行模式设置</a></li><li><a href=#http-响应头处理>HTTP 响应头处理</a></li></ul></li><li><a href=#变量的使用>变量的使用</a><ul><li><a href=#变量使用示例>变量使用示例</a></li><li><a href=#环境变量>环境变量</a></li></ul></li><li><a href=#请求的定义>请求的定义</a><ul><li><a href=#模拟批量写入>模拟批量写入</a></li><li><a href=#返回值判断>返回值判断</a></li><li><a href=#动态变量注册>动态变量注册</a></li></ul></li><li><a href=#执行压测>执行压测</a><ul><li><a href=#命令行参数>命令行参数</a></li><li><a href=#限制客户端压力>限制客户端压力</a></li><li><a href=#限制请求的总条数>限制请求的总条数</a></li><li><a href=#使用自增-id-来确保文档的顺序性>使用自增 ID 来确保文档的顺序性</a></li><li><a href=#上下文复用变量>上下文复用变量</a></li><li><a href=#自定义-header>自定义 Header</a></li></ul></li><li><a href=#运行测试套件>运行测试套件</a><ul><li><a href=#环境变量配置>环境变量配置</a></li><li><a href=#测试用例配置>测试用例配置</a></li><li><a href=#测试套件运行>测试套件运行</a></li></ul></li></ul></li></ul></nav></aside></main></body></html>